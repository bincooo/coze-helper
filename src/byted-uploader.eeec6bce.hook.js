(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["4927"],{730418:function(e,t,r){var i,n;e=r.nmd(e),i="undefined"!=typeof self?self:this,n=function(){return function(e){var t={};function r(i){var n;return(t[i]||(n=t[i]={i:i,l:!1,exports:{}},e[i].call(n.exports,n,n.exports,r),n.l=!0,n)).exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,(function(t){return e[t]}).bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=11)}([function(e,t,r){"use strict";var i="object"==typeof Reflect?Reflect:null,n=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},o=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise(function(r,i){var n,o,s;function a(r){e.removeListener(t,c),i(r)}function c(){"function"==typeof e.removeListener&&e.removeListener("error",a),r([].slice.call(arguments))}y(e,t,c,{once:!0}),"error"!==t&&(n=e,o=a,s={once:!0},"function"==typeof n.on&&y(n,"error",o,s))})},(a.EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function f(e,t,r,i){var n,o,s;return u(r),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,r.listener||r),n=e._events),o=n[t]),void 0===o?(o=n[t]=r,++e._eventsCount):("function"==typeof o?o=n[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),0<(n=l(e))&&o.length>n&&!o.warned&&(o.warned=!0,(i=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",i.emitter=e,i.type=t,i.count=o.length,s=i,console&&console.warn&&console.warn(s))),e}function p(e,t,r){return(t=(function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}).bind(e={fired:!1,wrapFn:void 0,target:e,type:t,listener:r})).listener=r,e.wrapFn=t}function h(e,t,r){var e=e._events;return void 0===e||void 0===(e=e[t])?[]:"function"==typeof e?r?[e.listener||e]:[e]:r?function(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(e):g(e,e.length)}function d(e){var t=this._events;if(void 0!==t){if("function"==typeof(t=t[e]))return 1;if(void 0!==t)return t.length}return 0}function g(e,t){for(var r=Array(t),i=0;i<t;++i)r[i]=e[i];return r}function y(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function n(o){i.once&&e.removeEventListener(t,n),r(o)})}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){if((s=0<t.length?t[0]:s)instanceof Error)throw s;throw(i=Error("Unhandled error."+(s?" ("+s.message+")":""))).context=s,i}var s=o[e];if(void 0===s)return!1;if("function"==typeof s)n(s,this,t);else for(var a=s.length,c=g(s,a),r=0;r<a;++r)n(c[r],this,t);return!0},a.prototype.on=a.prototype.addListener=function(e,t){return f(this,e,t,!1)},a.prototype.prependListener=function(e,t){return f(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},a.prototype.off=a.prototype.removeListener=function(e,t){var r,i,n,o,s;if(u(t),void 0!==(i=this._events)&&void 0!==(r=i[e])){if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,o=r.length-1;0<=o;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,n=o;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}}return this},a.prototype.removeAllListeners=function(e){var t,r=this._events;if(void 0!==r){if(void 0===r.removeListener)0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]);else if(0==arguments.length){for(var i,n=Object.keys(r),o=0;o<n.length;++o)"removeListener"!==(i=n[o])&&this.removeAllListeners(i);this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0}else if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(o=t.length-1;0<=o;o--)this.removeListener(e,t[o])}return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},a.prototype.listenerCount=d,a.prototype.eventNames=function(){return 0<this._eventsCount?o(this._events):[]}},function(e,t,r){(function(t){e.exports=function(e){"use strict";var r,i=(r=e)&&"object"==typeof r&&"default"in r?r:{default:r};function n(e,t){for(var r,i,n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(r=o.key,i=void 0,"symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(r,"string"))?i:String(i)),o)}}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function s(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var a=s(function(e,t){var r;e.exports=r||function(e,t){if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==o&&o.crypto&&(r=o.crypto),!r)try{r=i.default}catch(e){}var r,n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),a={},c=a.lib={},u=c.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=c.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||p).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<n;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=s<<24-(i+o)%4*8}else for(var a=0;a<n;a+=4)t[i+a>>>2]=r[a>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new l.init(t,e)}}),f=a.enc={},p=f.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var o=t[n>>>2]>>>24-n%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new l.init(r,t/2)}},h=f.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var o=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new l.init(r,t)}},d=f.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},g=c.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,i=this._data,n=i.words,o=i.sigBytes,s=this.blockSize,a=o/(4*s),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,u=e.min(4*c,o);if(c){for(var f=0;f<c;f+=s)this._doProcessBlock(n,f);r=n.splice(0,c),i.sigBytes-=u}return new l.init(r,u)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});c.Hasher=g.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new y.HMAC.init(e,r).finalize(t)}}});var y=a.algo={};return a}(Math)}),c=s(function(e,t){var r,i,n,o,s,c,u,l,f;e.exports=(r=Math,n=(i=a.lib).WordArray,o=i.Hasher,s=a.algo,c=[],u=[],function(){function e(e){return 4294967296*(e-(0|e))|0}for(var t=2,i=0;i<64;)(function(e){for(var t=r.sqrt(e),i=2;i<=t;i++)if(!(e%i))return!1;return!0})(t)&&(i<8&&(c[i]=e(r.pow(t,.5))),u[i]=e(r.pow(t,1/3)),i++),t++}(),l=[],f=s.SHA256=o.extend({_doReset:function(){this._hash=new n.init(c.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,i=r[0],n=r[1],o=r[2],s=r[3],a=r[4],c=r[5],f=r[6],p=r[7],h=0;h<64;h++){if(h<16)l[h]=0|e[t+h];else{var d=l[h-15],g=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,y=l[h-2],m=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;l[h]=g+l[h-7]+m+l[h-16]}var v=i&n^i&o^n&o,b=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),_=p+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&f)+u[h]+l[h];p=f,f=c,c=a,a=s+_|0,s=o,o=n,n=i,i=_+(b+v)|0}r[0]=r[0]+i|0,r[1]=r[1]+n|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0,r[5]=r[5]+c|0,r[6]=r[6]+f|0,r[7]=r[7]+p|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=r.floor(i/4294967296),t[15+(n+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),a.SHA256=o._createHelper(f),a.HmacSHA256=o._createHmacHelper(f),a.SHA256)}),u=(s(function(e,t){var r,i;e.exports=(r=a.lib.Base,i=a.enc.Utf8,void(a.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),a=o.words,c=s.words,u=0;u<r;u++)a[u]^=1549556828,c[u]^=909522486;o.sigBytes=s.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))}),s(function(e,t){e.exports=a.HmacSHA256})),l={hmac:function(e,t){return u(t,e)},sha256:function(e){return c(e)}},f=["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id"],p=function(e){try{return encodeURIComponent(e).replace(/[^A-Za-z0-9_.~\-%]+/g,escape).replace(/[*]/g,function(e){return"%".concat(e.charCodeAt(0).toString(16).toUpperCase())})}catch(e){return""}},h=function(e){return Object.keys(e).sort().map(function(t){var r=e[t];if(null!=r){var i=p(t);if(i)return Array.isArray(r)?"".concat(i,"=").concat(r.map(p).sort().join("&".concat(i,"="))):"".concat(i,"=").concat(p(r))}}).filter(function(e){return e}).join("&")};return function(){var e,t;function r(e,t,i){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),this.request=e,this.request.headers=e.headers||{},this.serviceName=t,i=i||{},this.signatureCache="boolean"!=typeof i.signatureCache||i.signatureCache,this.operation=i.operation,this.signatureVersion=i.signatureVersion,this.constant=i.isVolcengine?{algorithm:"HMAC-SHA256",v4Identifier:"request",dateHeader:"X-Date",tokenHeader:"x-security-token",contentSha256Header:"X-Content-Sha256",kDatePrefix:""}:{algorithm:"AWS4-HMAC-SHA256",v4Identifier:"aws4_request",dateHeader:"X-Amz-Date",tokenHeader:"x-amz-security-token",contentSha256Header:"X-Amz-Content-Sha256",kDatePrefix:"AWS4"},this.bodySha256=i.bodySha256,this.shouldSerializeBody="boolean"!=typeof i.shouldSerializeBody||i.shouldSerializeBody}return e=[{key:"addAuthorization",value:function(e,t){var r=this.iso8601(t).replace(/[:\-]|\.\d{3}/g,"");this.addHeaders(e,r),this.request.headers.Authorization=this.authorization(e,r)}},{key:"addHeaders",value:function(e,t){if(this.request.headers[this.constant.dateHeader]=t,e.sessionToken&&(this.request.headers[this.constant.tokenHeader]=e.sessionToken),this.request.body){var r=this.request.body;"string"!=typeof r&&this.shouldSerializeBody&&(r=r instanceof URLSearchParams?r.toString():JSON.stringify(r)),this.request.headers[this.constant.contentSha256Header]=this.bodySha256||l.sha256(r).toString()}}},{key:"authorization",value:function(e,t){var r=[],i=this.credentialString(t);return r.push("".concat(this.constant.algorithm," Credential=").concat(e.accessKeyId,"/").concat(i)),r.push("SignedHeaders=".concat(this.signedHeaders())),r.push("Signature=".concat(this.signature(e,t))),r.join(", ")}},{key:"signature",value:function(e,t){var r=this.getSigningKey(e,t.substr(0,8),this.request.region,this.serviceName,this.signatureCache);return l.hmac(r,this.stringToSign(t),"hex")}},{key:"stringToSign",value:function(e){var t=[];return t.push(this.constant.algorithm),t.push(e),t.push(this.credentialString(e)),t.push(this.hexEncodedHash(this.canonicalString())),t.join("\n")}},{key:"canonicalString",value:function(){var e=[],t=this.request.pathname||"/";return e.push(this.request.method.toUpperCase()),e.push(t),e.push(h(this.request.params)||""),e.push("".concat(this.canonicalHeaders(),"\n")),e.push(this.signedHeaders()),e.push(this.hexEncodedBodyHash()),e.join("\n")}},{key:"canonicalHeaders",value:function(){var e=this,t=[];Object.keys(this.request.headers).forEach(function(r){t.push([r,e.request.headers[r]])}),t.sort(function(e,t){return e[0].toLowerCase()<t[0].toLowerCase()?-1:1});var r=[];return t.forEach(function(t){var i=t[0].toLowerCase();if(e.isSignableHeader(i)){var n=t[1];if(null==n||"function"!=typeof n.toString)throw Error("Header ".concat(i," contains invalid value"));r.push("".concat(i,":").concat(e.canonicalHeaderValues(n.toString())))}}),r.join("\n")}},{key:"canonicalHeaderValues",value:function(e){return e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")}},{key:"signedHeaders",value:function(){var e=this,t=[];return Object.keys(this.request.headers).forEach(function(r){r=r.toLowerCase(),e.isSignableHeader(r)&&t.push(r)}),t.sort().join(";")}},{key:"credentialString",value:function(e){return this.createScope(e.substr(0,8),this.request.region,this.serviceName)}},{key:"hexEncodedHash",value:function(e){return l.sha256(e)}},{key:"hexEncodedBodyHash",value:function(){return this.request.headers[this.constant.contentSha256Header]?this.request.headers[this.constant.contentSha256Header]:this.request.body?this.hexEncodedHash(h(this.request.body)):this.hexEncodedHash("")}},{key:"isSignableHeader",value:function(e){return 0===e.toLowerCase().indexOf("x-amz-")||0>f.indexOf(e)}},{key:"iso8601",value:function(e){return void 0===e&&(e=new Date),e.toISOString().replace(/\.\d{3}Z$/,"Z")}},{key:"getSigningKey",value:function(e,t,r,i){var n=l.hmac("".concat(this.constant.kDatePrefix).concat(e.secretAccessKey),t),o=l.hmac(n,r),s=l.hmac(o,i);return l.hmac(s,this.constant.v4Identifier)}},{key:"createScope",value:function(e,t,r){return[e.substr(0,8),t,r,this.constant.v4Identifier].join("/")}}],n(r.prototype,e),t&&n(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}()}(r(9))}).call(this,r(5))},function(e,t,r){e.exports=function(){return r(10)('!function(t){var n={};function __webpack_require__(r){var e;return(n[r]||(e=n[r]={i:r,l:!1,exports:{}},t[r].call(e.exports,e,e.exports,__webpack_require__),e.l=!0,e)).exports}__webpack_require__.m=t,__webpack_require__.c=n,__webpack_require__.d=function(r,e,t){__webpack_require__.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:t})},__webpack_require__.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},__webpack_require__.t=function(e,r){if(1&r&&(e=__webpack_require__(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(__webpack_require__.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)__webpack_require__.d(t,n,function(r){return e[r]}.bind(null,n));return t},__webpack_require__.n=function(r){var e=r&&r.__esModule?function getDefault(){return r.default}:function getModuleExports(){return r};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=9)}([function(r,e,y){!function(_){r.exports=function(){var r=r||function(u,t){var r;if(typeof window!=="undefined"&&window.crypto)r=window.crypto;if(typeof self!=="undefined"&&self.crypto)r=self.crypto;if(typeof globalThis!=="undefined"&&globalThis.crypto)r=globalThis.crypto;if(!r&&typeof window!=="undefined"&&window.msCrypto)r=window.msCrypto;if(!r&&typeof _!=="undefined"&&_.crypto)r=_.crypto;if(!r&&"function"==="function")try{r=y(11)}catch(r){}var n=function(){if(r){if(typeof r.getRandomValues==="function")try{return r.getRandomValues(new Uint32Array(1))[0]}catch(r){}if(typeof r.randomBytes==="function")try{return r.randomBytes(4).readInt32LE()}catch(r){}}throw new Error("Native crypto module could not be used to get secure random number.")};var i=Object.create||function(){function F(){}return function(r){var e;F.prototype=r;e=new F;F.prototype=null;return e}}();var e={};var a=e.lib={};var o=a.Base=function(){return{extend:function(r){var e=i(this);if(r)e.mixIn(r);if(!e.hasOwnProperty("init")||this.init===e.init)e.init=function(){e.$super.init.apply(this,arguments)};e.init.prototype=e;e.$super=this;return e},create:function(){var r=this.extend();r.init.apply(r,arguments);return r},init:function(){},mixIn:function(r){for(var e in r)if(r.hasOwnProperty(e))this[e]=r[e];if(r.hasOwnProperty("toString"))this.toString=r.toString},clone:function(){return this.init.prototype.extend(this)}}}();var h=a.WordArray=o.extend({init:function(r,e){r=this.words=r||[];if(e!=t)this.sigBytes=e;else this.sigBytes=r.length*4},toString:function(r){return(r||s).stringify(this)},concat:function(r){var e=this.words;var t=r.words;var n=this.sigBytes;var i=r.sigBytes;this.clamp();if(n%4)for(var a=0;a<i;a++){var o=t[a>>>2]>>>24-a%4*8&255;e[n+a>>>2]|=o<<24-(n+a)%4*8}else for(var c=0;c<i;c+=4)e[n+c>>>2]=t[c>>>2];this.sigBytes+=i;return this},clamp:function(){var r=this.words;var e=this.sigBytes;r[e>>>2]&=4294967295<<32-e%4*8;r.length=u.ceil(e/4)},clone:function(){var r=o.clone.call(this);r.words=this.words.slice(0);return r},random:function(r){var e=[];for(var t=0;t<r;t+=4)e.push(n());return new h.init(e,r)}});var c=e.enc={};var s=c.Hex={stringify:function(r){var e=r.words;var t=r.sigBytes;var n=[];for(var i=0;i<t;i++){var a=e[i>>>2]>>>24-i%4*8&255;n.push((a>>>4).toString(16));n.push((a&15).toString(16))}return n.join("")},parse:function(r){var e=r.length;var t=[];for(var n=0;n<e;n+=2)t[n>>>3]|=parseInt(r.substr(n,2),16)<<24-n%8*4;return new h.init(t,e/2)}};var f=c.Latin1={stringify:function(r){var e=r.words;var t=r.sigBytes;var n=[];for(var i=0;i<t;i++){var a=e[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(r){var e=r.length;var t=[];for(var n=0;n<e;n++)t[n>>>2]|=(r.charCodeAt(n)&255)<<24-n%4*8;return new h.init(t,e)}};var v=c.Utf8={stringify:function(r){try{return decodeURIComponent(escape(f.stringify(r)))}catch(r){throw new Error("Malformed UTF-8 data")}},parse:function(r){return f.parse(unescape(encodeURIComponent(r)))}};var p=a.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new h.init;this._nDataBytes=0},_append:function(r){if(typeof r=="string")r=v.parse(r);this._data.concat(r);this._nDataBytes+=r.sigBytes},_process:function(r){var e;var t=this._data;var n=t.words;var i=t.sigBytes;var a=this.blockSize;var o=a*4;var c=i/o;if(r)c=u.ceil(c);else c=u.max((c|0)-this._minBufferSize,0);var s=c*a;var f=u.min(s*4,i);if(s){for(var v=0;v<s;v+=a)this._doProcessBlock(n,v);e=n.splice(0,s);t.sigBytes-=f}return new h.init(e,f)},clone:function(){var r=o.clone.call(this);r._data=this._data.clone();return r},_minBufferSize:0});var l=a.Hasher=p.extend({cfg:o.extend(),init:function(r){this.cfg=this.cfg.extend(r);this.reset()},reset:function(){p.reset.call(this);this._doReset()},update:function(r){this._append(r);this._process();return this},finalize:function(r){if(r)this._append(r);var e=this._doFinalize();return e},blockSize:512/32,_createHelper:function(t){return function(r,e){return new t.init(e).finalize(r)}},_createHmacHelper:function(t){return function(r,e){return new d.HMAC.init(t,e).finalize(r)}}});var d=e.algo={};return e}(Math);return r}()}.call(this,y(10))},function(r,e,t){r.exports=function(F){F.lib.Cipher||function(o){var r=F;var e=r.lib;var t=e.Base;var s=e.WordArray;var n=e.BufferedBlockAlgorithm;var i=r.enc;var a=i.Utf8;var c=i.Base64;var f=r.algo;var v=f.EvpKDF;var u=e.Cipher=n.extend({cfg:t.extend(),createEncryptor:function(r,e){return this.create(this._ENC_XFORM_MODE,r,e)},createDecryptor:function(r,e){return this.create(this._DEC_XFORM_MODE,r,e)},init:function(r,e,t){this.cfg=this.cfg.extend(t);this._xformMode=r;this._key=e;this.reset()},reset:function(){n.reset.call(this);this._doReset()},process:function(r){this._append(r);return this._process()},finalize:function(r){if(r)this._append(r);var e=this._doFinalize();return e},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(r){if(typeof r=="string")return S;else return m}return function(n){return{encrypt:function(r,e,t){return selectCipherStrategy(e).encrypt(n,r,e,t)},decrypt:function(r,e,t){return selectCipherStrategy(e).decrypt(n,r,e,t)}}}}()});var h=e.StreamCipher=u.extend({_doFinalize:function(){var r=this._process(!!"flush");return r},blockSize:1});var p=r.mode={};var l=e.BlockCipherMode=t.extend({createEncryptor:function(r,e){return this.Encryptor.create(r,e)},createDecryptor:function(r,e){return this.Decryptor.create(r,e)},init:function(r,e){this._cipher=r;this._iv=e}});var d=p.CBC=function(){var r=l.extend();r.Encryptor=r.extend({processBlock:function(r,e){var t=this._cipher;var n=t.blockSize;xorBlock.call(this,r,e,n);t.encryptBlock(r,e);this._prevBlock=r.slice(e,e+n)}});r.Decryptor=r.extend({processBlock:function(r,e){var t=this._cipher;var n=t.blockSize;var i=r.slice(e,e+n);t.decryptBlock(r,e);xorBlock.call(this,r,e,n);this._prevBlock=i}});function xorBlock(r,e,t){var n;var i=this._iv;if(i){n=i;this._iv=o}else n=this._prevBlock;for(var a=0;a<t;a++)r[e+a]^=n[a]}return r}();var _=r.pad={};var y=_.Pkcs7={pad:function(r,e){var t=e*4;var n=t-r.sigBytes%t;var i=n<<24|n<<16|n<<8|n;var a=[];for(var o=0;o<n;o+=4)a.push(i);var c=s.create(a,n);r.concat(c)},unpad:function(r){var e=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=e}};var g=e.BlockCipher=u.extend({cfg:u.cfg.extend({mode:d,padding:y}),reset:function(){var r;u.reset.call(this);var e=this.cfg;var t=e.iv;var n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)r=n.createEncryptor;else{r=n.createDecryptor;this._minBufferSize=1}if(this._mode&&this._mode.__creator==r)this._mode.init(this,t&&t.words);else{this._mode=r.call(n,this,t&&t.words);this._mode.__creator=r}},_doProcessBlock:function(r,e){this._mode.processBlock(r,e)},_doFinalize:function(){var r;var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);r=this._process(!!"flush")}else{r=this._process(!!"flush");e.unpad(r)}return r},blockSize:128/32});var w=e.CipherParams=t.extend({init:function(r){this.mixIn(r)},toString:function(r){return(r||this.formatter).stringify(this)}});var k=r.format={};var B=k.OpenSSL={stringify:function(r){var e;var t=r.ciphertext;var n=r.salt;if(n)e=s.create([1398893684,1701076831]).concat(n).concat(t);else e=t;return e.toString(c)},parse:function(r){var e;var t=c.parse(r);var n=t.words;if(n[0]==1398893684&&n[1]==1701076831){e=s.create(n.slice(2,4));n.splice(0,4);t.sigBytes-=16}return w.create({ciphertext:t,salt:e})}};var m=e.SerializableCipher=t.extend({cfg:t.extend({format:B}),encrypt:function(r,e,t,n){n=this.cfg.extend(n);var i=r.createEncryptor(t,n);var a=i.finalize(e);var o=i.cfg;return w.create({ciphertext:a,key:t,iv:o.iv,algorithm:r,mode:o.mode,padding:o.padding,blockSize:r.blockSize,formatter:n.format})},decrypt:function(r,e,t,n){n=this.cfg.extend(n);e=this._parse(e,n.format);var i=r.createDecryptor(t,n).finalize(e.ciphertext);return i},_parse:function(r,e){if(typeof r=="string")return e.parse(r,this);else return r}});var x=r.kdf={};var b=x.OpenSSL={execute:function(r,e,t,n,i){if(!n)n=s.random(64/8);if(!i)var a=v.create({keySize:e+t}).compute(r,n);else var a=v.create({keySize:e+t,hasher:i}).compute(r,n);var o=s.create(a.words.slice(e),t*4);a.sigBytes=e*4;return w.create({key:a,iv:o,salt:n})}};var S=e.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:b}),encrypt:function(r,e,t,n){n=this.cfg.extend(n);var i=n.kdf.execute(t,r.keySize,r.ivSize,n.salt,n.hasher);n.iv=i.iv;var a=m.encrypt.call(this,r,e,i.key,n);a.mixIn(i);return a},decrypt:function(r,e,t,n){n=this.cfg.extend(n);e=this._parse(e,n.format);var i=n.kdf.execute(t,r.keySize,r.ivSize,e.salt,n.hasher);n.iv=i.iv;var a=m.decrypt.call(this,r,e,i.key,n);return a}})}()}(t(0),t(5))},function(r,e,t){r.exports=function(a){return function(){var r=a;var e=r.lib;var t=e.BlockCipher;var n=r.algo;var v=[];var f=[];var u=[];var h=[];var p=[];var l=[];var d=[];var _=[];var y=[];var g=[];(function(){var r=[];for(var e=0;e<256;e++)if(e<128)r[e]=e<<1;else r[e]=e<<1^283;var t=0;var n=0;for(var e=0;e<256;e++){var i=n^n<<1^n<<2^n<<3^n<<4;i=i>>>8^i&255^99;v[t]=i;f[i]=t;var a=r[t];var o=r[a];var c=r[o];var s=r[i]*257^i*16843008;u[t]=s<<24|s>>>8;h[t]=s<<16|s>>>16;p[t]=s<<8|s>>>24;l[t]=s;var s=c*16843009^o*65537^a*257^t*16843008;d[i]=s<<24|s>>>8;_[i]=s<<16|s>>>16;y[i]=s<<8|s>>>24;g[i]=s;if(!t)t=n=1;else{t=a^r[r[r[c^a]]];n^=r[r[n]]}}})();var w=[0,1,2,4,8,16,32,64,128,27,54];var i=n.AES=t.extend({_doReset:function(){var r;if(this._nRounds&&this._keyPriorReset===this._key)return;var e=this._keyPriorReset=this._key;var t=e.words;var n=e.sigBytes/4;var i=this._nRounds=n+6;var a=(i+1)*4;var o=this._keySchedule=[];for(var c=0;c<a;c++)if(c<n)o[c]=t[c];else{r=o[c-1];if(!(c%n)){r=r<<8|r>>>24;r=v[r>>>24]<<24|v[r>>>16&255]<<16|v[r>>>8&255]<<8|v[r&255];r^=w[c/n|0]<<24}else if(n>6&&c%n==4)r=v[r>>>24]<<24|v[r>>>16&255]<<16|v[r>>>8&255]<<8|v[r&255];o[c]=o[c-n]^r}var s=this._invKeySchedule=[];for(var f=0;f<a;f++){var c=a-f;if(f%4)var r=o[c];else var r=o[c-4];if(f<4||c<=4)s[f]=r;else s[f]=d[v[r>>>24]]^_[v[r>>>16&255]]^y[v[r>>>8&255]]^g[v[r&255]]}},encryptBlock:function(r,e){this._doCryptBlock(r,e,this._keySchedule,u,h,p,l,v)},decryptBlock:function(r,e){var t=r[e+1];r[e+1]=r[e+3];r[e+3]=t;this._doCryptBlock(r,e,this._invKeySchedule,d,_,y,g,f);var t=r[e+1];r[e+1]=r[e+3];r[e+3]=t},_doCryptBlock:function(r,e,t,n,i,a,o,c){var s=this._nRounds;var f=r[e]^t[0];var v=r[e+1]^t[1];var u=r[e+2]^t[2];var h=r[e+3]^t[3];var p=4;for(var l=1;l<s;l++){var d=n[f>>>24]^i[v>>>16&255]^a[u>>>8&255]^o[h&255]^t[p++];var _=n[v>>>24]^i[u>>>16&255]^a[h>>>8&255]^o[f&255]^t[p++];var y=n[u>>>24]^i[h>>>16&255]^a[f>>>8&255]^o[v&255]^t[p++];var g=n[h>>>24]^i[f>>>16&255]^a[v>>>8&255]^o[u&255]^t[p++];f=d;v=_;u=y;h=g}var d=(c[f>>>24]<<24|c[v>>>16&255]<<16|c[u>>>8&255]<<8|c[h&255])^t[p++];var _=(c[v>>>24]<<24|c[u>>>16&255]<<16|c[h>>>8&255]<<8|c[f&255])^t[p++];var y=(c[u>>>24]<<24|c[h>>>16&255]<<16|c[f>>>8&255]<<8|c[v&255])^t[p++];var g=(c[h>>>24]<<24|c[f>>>16&255]<<16|c[v>>>8&255]<<8|c[u&255])^t[p++];r[e]=d;r[e+1]=_;r[e+2]=y;r[e+3]=g},keySize:256/32});r.AES=t._createHelper(i)}(),a.AES}(t(0),(t(12),t(13),t(5),t(1)))},function(r,e,t){r.exports=function(e){return e.mode.ECB=function(){var r=e.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(r,e){this._cipher.encryptBlock(r,e)}});r.Decryptor=r.extend({processBlock:function(r,e){this._cipher.decryptBlock(r,e)}});return r}(),e.mode.ECB}(t(0),t(1))},function(r,e,t){r.exports=function(r){return r.enc.Utf8}(t(0))},function(r,e,t){r.exports=function(o){return function(){var r=o;var e=r.lib;var t=e.Base;var v=e.WordArray;var n=r.algo;var i=n.MD5;var a=n.EvpKDF=t.extend({cfg:t.extend({keySize:128/32,hasher:i,iterations:1}),init:function(r){this.cfg=this.cfg.extend(r)},compute:function(r,e){var t;var n=this.cfg;var i=n.hasher.create();var a=v.create();var o=a.words;var c=n.keySize;var s=n.iterations;while(o.length<c){if(t)i.update(t);t=i.update(r).finalize(e);i.reset();for(var f=1;f<s;f++){t=i.finalize(t);i.reset()}a.concat(t)}a.sigBytes=c*4;return a}});r.EvpKDF=function(r,e,t){return a.create(t).compute(r,e)}}(),o.EvpKDF}(t(0),(t(14),t(15)))},function(r,e,t){r.exports=function(r){return r.pad.Pkcs7}(t(0),t(1))},function(r,e,t){r.exports=function(r){return r.pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding}(t(0),t(1))},function(r,e,t){r.exports=function(a){return function(){if(typeof ArrayBuffer!="function")return;var r=a;var e=r.lib;var t=e.WordArray;var i=t.init;var n=t.init=function(r){if(r instanceof ArrayBuffer)r=new Uint8Array(r);if(r instanceof Int8Array||typeof Uint8ClampedArray!=="undefined"&&r instanceof Uint8ClampedArray||r instanceof Int16Array||r instanceof Uint16Array||r instanceof Int32Array||r instanceof Uint32Array||r instanceof Float32Array||r instanceof Float64Array)r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);if(r instanceof Uint8Array){var e=r.byteLength;var t=[];for(var n=0;n<e;n++)t[n>>>2]|=r[n]<<24-n%4*8;i.call(this,t,e)}else i.apply(this,arguments)};n.prototype=t}(),a.lib.WordArray}(t(0))},function(r,e,t){"use strict";t.r(e);var e=t(2),o=t.n(e),e=t(3),c=t.n(e),e=t(6),s=t.n(e),e=t(7),f=t.n(e),e=t(8),v=t.n(e),e=t(4),u=t.n(e);function crc32(r,e){for(var t=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],n=("undefined"!=typeof Int32Array&&(t=new Int32Array(t)),-1^~~e),i=(r=new Uint8Array(r)).length,a=0;a<i;a++)n=t[255&(n^r[a])]^n>>>8;return(-1^n)>>>0}function dec2hex(r){if(void 0!==r)return function toEight(r){return r.length<8?toEight(r="0".concat(r)):r}(Number(r).toString(16))}self.onmessage=function(r){var r=r.data,e=r[0],t=r[1],n=r[2],i=r[3],a=r[4],r=r[5];i?(i=v.a.create(e),i=crc32(r=function wordArrayToUint8Array(r){for(var e=r.sigBytes,t=r.words,n=new Uint8Array(e),i=0,a=0;i!==e;){var o=t[a++];if(n[i++]=(4278190080&o)>>>24,i===e)break;if(n[i++]=(16711680&o)>>>16,i===e)break;if(n[i++]=(65280&o)>>>8,i===e)break;n[i++]=255&o}return n}((r&&e.byteLength%16!=0?o.a.encrypt(i,u.a.parse(a),{mode:c.a,padding:s.a}):o.a.encrypt(i,u.a.parse(a),{mode:c.a,padding:f.a})).ciphertext),0),postMessage([r.buffer,dec2hex(i),t,n],[r.buffer])):(a=crc32(e,0),postMessage([e,dec2hex(a),t,n],[e]))}},function(r,e){var t=function(){return this}();try{t=t||new Function("return this")()}catch(r){"object"==typeof window&&(t=window)}r.exports=t},function(r,e){},function(r,e,t){r.exports=function(i){return function(){var r=i;var e=r.lib;var f=e.WordArray;var t=r.enc;var n=t.Base64={stringify:function(r){var e=r.words;var t=r.sigBytes;var n=this._map;r.clamp();var i=[];for(var a=0;a<t;a+=3){var o=e[a>>>2]>>>24-a%4*8&255;var c=e[a+1>>>2]>>>24-(a+1)%4*8&255;var s=e[a+2>>>2]>>>24-(a+2)%4*8&255;var f=o<<16|c<<8|s;for(var v=0;v<4&&a+v*.75<t;v++)i.push(n.charAt(f>>>6*(3-v)&63))}var u=n.charAt(64);if(u)while(i.length%4)i.push(u);return i.join("")},parse:function(r){var e=r.length;var t=this._map;var n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<t.length;i++)n[t.charCodeAt(i)]=i}var a=t.charAt(64);if(a){var o=r.indexOf(a);if(o!==-1)e=o}return parseLoop(r,e,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function parseLoop(r,e,t){var n=[];var i=0;for(var a=0;a<e;a++)if(a%4){var o=t[r.charCodeAt(a-1)]<<a%4*2;var c=t[r.charCodeAt(a)]>>>6-a%4*2;var s=o|c;n[i>>>2]|=s<<24-i%4*8;i++}return f.create(n,i)}}(),i.enc.Base64}(t(0))},function(r,e,t){r.exports=function(o){return function(v){var r=o;var e=r.lib;var t=e.WordArray;var n=e.Hasher;var i=r.algo;var F=[];(function(){for(var r=0;r<64;r++)F[r]=v.abs(v.sin(r+1))*4294967296|0})();var a=i.MD5=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(r,e){for(var t=0;t<16;t++){var n=e+t;var i=r[n];r[n]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360}var a=this._hash.words;var o=r[e+0];var c=r[e+1];var s=r[e+2];var f=r[e+3];var v=r[e+4];var u=r[e+5];var h=r[e+6];var p=r[e+7];var l=r[e+8];var d=r[e+9];var _=r[e+10];var y=r[e+11];var g=r[e+12];var w=r[e+13];var k=r[e+14];var B=r[e+15];var m=a[0];var x=a[1];var b=a[2];var S=a[3];m=FF(m,x,b,S,o,7,F[0]);S=FF(S,m,x,b,c,12,F[1]);b=FF(b,S,m,x,s,17,F[2]);x=FF(x,b,S,m,f,22,F[3]);m=FF(m,x,b,S,v,7,F[4]);S=FF(S,m,x,b,u,12,F[5]);b=FF(b,S,m,x,h,17,F[6]);x=FF(x,b,S,m,p,22,F[7]);m=FF(m,x,b,S,l,7,F[8]);S=FF(S,m,x,b,d,12,F[9]);b=FF(b,S,m,x,_,17,F[10]);x=FF(x,b,S,m,y,22,F[11]);m=FF(m,x,b,S,g,7,F[12]);S=FF(S,m,x,b,w,12,F[13]);b=FF(b,S,m,x,k,17,F[14]);x=FF(x,b,S,m,B,22,F[15]);m=GG(m,x,b,S,c,5,F[16]);S=GG(S,m,x,b,h,9,F[17]);b=GG(b,S,m,x,y,14,F[18]);x=GG(x,b,S,m,o,20,F[19]);m=GG(m,x,b,S,u,5,F[20]);S=GG(S,m,x,b,_,9,F[21]);b=GG(b,S,m,x,B,14,F[22]);x=GG(x,b,S,m,v,20,F[23]);m=GG(m,x,b,S,d,5,F[24]);S=GG(S,m,x,b,k,9,F[25]);b=GG(b,S,m,x,f,14,F[26]);x=GG(x,b,S,m,l,20,F[27]);m=GG(m,x,b,S,w,5,F[28]);S=GG(S,m,x,b,s,9,F[29]);b=GG(b,S,m,x,p,14,F[30]);x=GG(x,b,S,m,g,20,F[31]);m=HH(m,x,b,S,u,4,F[32]);S=HH(S,m,x,b,l,11,F[33]);b=HH(b,S,m,x,y,16,F[34]);x=HH(x,b,S,m,k,23,F[35]);m=HH(m,x,b,S,c,4,F[36]);S=HH(S,m,x,b,v,11,F[37]);b=HH(b,S,m,x,p,16,F[38]);x=HH(x,b,S,m,_,23,F[39]);m=HH(m,x,b,S,w,4,F[40]);S=HH(S,m,x,b,o,11,F[41]);b=HH(b,S,m,x,f,16,F[42]);x=HH(x,b,S,m,h,23,F[43]);m=HH(m,x,b,S,d,4,F[44]);S=HH(S,m,x,b,g,11,F[45]);b=HH(b,S,m,x,B,16,F[46]);x=HH(x,b,S,m,s,23,F[47]);m=II(m,x,b,S,o,6,F[48]);S=II(S,m,x,b,p,10,F[49]);b=II(b,S,m,x,k,15,F[50]);x=II(x,b,S,m,u,21,F[51]);m=II(m,x,b,S,g,6,F[52]);S=II(S,m,x,b,f,10,F[53]);b=II(b,S,m,x,_,15,F[54]);x=II(x,b,S,m,c,21,F[55]);m=II(m,x,b,S,l,6,F[56]);S=II(S,m,x,b,B,10,F[57]);b=II(b,S,m,x,h,15,F[58]);x=II(x,b,S,m,w,21,F[59]);m=II(m,x,b,S,v,6,F[60]);S=II(S,m,x,b,y,10,F[61]);b=II(b,S,m,x,s,15,F[62]);x=II(x,b,S,m,d,21,F[63]);a[0]=a[0]+m|0;a[1]=a[1]+x|0;a[2]=a[2]+b|0;a[3]=a[3]+S|0},_doFinalize:function(){var r=this._data;var e=r.words;var t=this._nDataBytes*8;var n=r.sigBytes*8;e[n>>>5]|=128<<24-n%32;var i=v.floor(t/4294967296);var a=t;e[(n+64>>>9<<4)+15]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360;e[(n+64>>>9<<4)+14]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360;r.sigBytes=(e.length+1)*4;this._process();var o=this._hash;var c=o.words;for(var s=0;s<4;s++){var f=c[s];c[s]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360}return o},clone:function(){var r=n.clone.call(this);r._hash=this._hash.clone();return r}});function FF(r,e,t,n,i,a,o){var c=r+(e&t|~e&n)+i+o;return(c<<a|c>>>32-a)+e}function GG(r,e,t,n,i,a,o){var c=r+(e&n|t&~n)+i+o;return(c<<a|c>>>32-a)+e}function HH(r,e,t,n,i,a,o){var c=r+(e^t^n)+i+o;return(c<<a|c>>>32-a)+e}function II(r,e,t,n,i,a,o){var c=r+(t^(e|~n))+i+o;return(c<<a|c>>>32-a)+e}r.MD5=n._createHelper(a);r.HmacMD5=n._createHmacHelper(a)}(Math),o.MD5}(t(0))},function(r,e,t){r.exports=function(o){return function(){var r=o;var e=r.lib;var t=e.WordArray;var n=e.Hasher;var i=r.algo;var u=[];var a=i.SHA1=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(r,e){var t=this._hash.words;var n=t[0];var i=t[1];var a=t[2];var o=t[3];var c=t[4];for(var s=0;s<80;s++){if(s<16)u[s]=r[e+s]|0;else{var f=u[s-3]^u[s-8]^u[s-14]^u[s-16];u[s]=f<<1|f>>>31}var v=(n<<5|n>>>27)+c+u[s];if(s<20)v+=(i&a|~i&o)+1518500249;else if(s<40)v+=(i^a^o)+1859775393;else if(s<60)v+=(i&a|i&o|a&o)-1894007588;else v+=(i^a^o)-899497514;c=o;o=a;a=i<<30|i>>>2;i=n;n=v}t[0]=t[0]+n|0;t[1]=t[1]+i|0;t[2]=t[2]+a|0;t[3]=t[3]+o|0;t[4]=t[4]+c|0},_doFinalize:function(){var r=this._data;var e=r.words;var t=this._nDataBytes*8;var n=r.sigBytes*8;e[n>>>5]|=128<<24-n%32;e[(n+64>>>9<<4)+14]=Math.floor(t/4294967296);e[(n+64>>>9<<4)+15]=t;r.sigBytes=e.length*4;this._process();return this._hash},clone:function(){var r=n.clone.call(this);r._hash=this._hash.clone();return r}});r.SHA1=n._createHelper(a);r.HmacSHA1=n._createHmacHelper(a)}(),o.SHA1}(t(0))},function(r,e,t){r.exports=function(o){(function(){var r=o;var e=r.lib;var t=e.Base;var n=r.enc;var f=n.Utf8;var i=r.algo;var a=i.HMAC=t.extend({init:function(r,e){r=this._hasher=new r.init;if(typeof e=="string")e=f.parse(e);var t=r.blockSize;var n=t*4;if(e.sigBytes>n)e=r.finalize(e);e.clamp();var i=this._oKey=e.clone();var a=this._iKey=e.clone();var o=i.words;var c=a.words;for(var s=0;s<t;s++){o[s]^=1549556828;c[s]^=909522486}i.sigBytes=a.sigBytes=n;this.reset()},reset:function(){var r=this._hasher;r.reset();r.update(this._iKey)},update:function(r){this._hasher.update(r);return this},finalize:function(r){var e=this._hasher;var t=e.finalize(r);e.reset();var n=e.finalize(this._oKey.clone().concat(t));return n}})})()}(t(0))}]);',null)}},function(e,t,r){(function(t){var i;e.exports=i||function(e,i){if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==t&&t.crypto&&(n=t.crypto),!n)try{n=r(7)}catch(e){}var n,o=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),a={},c=a.lib={},u=c.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),(!t.hasOwnProperty("init")||this.init===t.init)&&(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=c.WordArray=u.extend({init:function(e,t){e=this.words=e||[],void 0!=t?this.sigBytes=t:this.sigBytes=4*e.length},toString:function(e){return(e||p).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<n;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=s<<24-(i+o)%4*8}else for(var a=0;a<n;a+=4)t[i+a>>>2]=r[a>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(o());return new l.init(t,e)}}),f=a.enc={},p=f.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var o=t[n>>>2]>>>24-n%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new l.init(r,t/2)}},h=f.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var o=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new l.init(r,t)}},d=f.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},g=c.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,i=this._data,n=i.words,o=i.sigBytes,s=this.blockSize,a=o/(4*s),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,u=e.min(4*c,o);if(c){for(var f=0;f<c;f+=s)this._doProcessBlock(n,f);r=n.splice(0,c),i.sigBytes-=u}return new l.init(r,u)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});c.Hasher=g.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new y.HMAC.init(e,r).finalize(t)}}});var y=a.algo={};return a}(Math)}).call(this,r(5))},function(e,t,r){var i;e.exports=(i=r(3),function(e){var t=i.lib,r=t.WordArray,n=t.Hasher,o=i.algo,s=[],a=[];(function(){function t(e){return(e-(0|e))*4294967296|0}for(var r=2,i=0;i<64;)(function(t){for(var r=e.sqrt(t),i=2;i<=r;i++)if(!(t%i))return!1;return!0})(r)&&(i<8&&(s[i]=t(e.pow(r,.5))),a[i]=t(e.pow(r,1/3)),i++),r++})();var c=[],u=o.SHA256=n.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,i=r[0],n=r[1],o=r[2],s=r[3],u=r[4],l=r[5],f=r[6],p=r[7],h=0;h<64;h++){if(h<16)c[h]=0|e[t+h];else{var d=c[h-15],g=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,y=c[h-2],m=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;c[h]=g+c[h-7]+m+c[h-16]}var v=u&l^~u&f,b=i&n^i&o^n&o,_=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),S=p+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+v+a[h]+c[h],w=_+b;p=f,f=l,l=u,u=s+S|0,s=o,o=n,n=i,i=S+w|0}r[0]=r[0]+i|0,r[1]=r[1]+n|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+u|0,r[5]=r[5]+l|0,r[6]=r[6]+f|0,r[7]=r[7]+p|0},_doFinalize:function(){var t=this._data,r=t.words,i=8*this._nDataBytes,n=8*t.sigBytes;return r[n>>>5]|=128<<24-n%32,r[(n+64>>>9<<4)+14]=e.floor(i/4294967296),r[(n+64>>>9<<4)+15]=i,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});i.SHA256=n._createHelper(u),i.HmacSHA256=n._createHmacHelper(u)}(Math),i.SHA256)},function(e,t){var r=function(){return this}();try{r=r||Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var i;e.exports=(i=r(3),r(4),r(8),i.HmacSHA256)},function(e,t){},function(e,t,r){var i,n,o;e.exports=void(n=(i=r(3)).lib.Base,o=i.enc.Utf8,i.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var r=e.blockSize,i=4*r;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var n=this._oKey=t.clone(),s=this._iKey=t.clone(),a=n.words,c=s.words,u=0;u<r;u++)a[u]^=1549556828,c[u]^=909522486;n.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}}))},function(e,t){},function(e,t,r){"use strict";var i=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(i.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(t)return new Worker(t);throw Error("Inline worker is not supported")}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return ry});var i,n,o,s,a,c,u,l,f,t=r(0),p=r.n(t),h="{tosDomain}/upload/v1/{oid}?uploadid={uploadId}&part_number={part_number}&phase=transfer",d="{tosDomain}/upload/v1/{oid}",g={debug:!1,region:"us-east-1",external:{},getSliceFunc:null,uploadSliceCount:3,retryUploadTime:2,retryProcess:!0,retryProcessTime:3,retryTaskTime:2,progressMonitorTime:10,progressMonitorSpeed:50,schema:"https",enableDiskBreakpoint:!0,replace:{}},y=function(){return(y=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(i=o.next()).done;)s.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return s}(arguments[t]));return e}function v(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)}function b(e){return function(e){if("string"==typeof e){for(var t=[],r=e.split("z"),i=0;i<r.length;i++){var n=64^+parseInt(r[i],25),n=String.fromCharCode(n);t.push(n)}return t.join("")}}(e)}function _(e){var t=document.createElement("a");return t.href=e,t}function S(e){var t={};try{_(e).search.slice(1).split("&").forEach(function(e){var r,i,n=e.split("=");n.length&&(r=n[0],i=n[1]);try{t[r]=decodeURIComponent(void 0===i?"":i)}catch(e){t[r]=i}})}catch(e){}return t}function w(e,t){try{return I.get(e)}catch(e){return""}}function k(e,t,r,i){try{var n=i||document.domain,o=+new Date+(r||6048e5);I.set(e,t,{expires:new Date(o),path:"/",domain:n})}catch(e){}}function x(){return(function e(t){return t?(t^16*Math.random()>>t/4).toString(10):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e)})().replace(/-/g,"").slice(0,19)}function O(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var E,T,C,D,z,j=function(){function e(){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var r=this;e&&t&&"function"==typeof t&&this.on(e,function i(n){t(n),r.off(e,i)})},e.prototype.off=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&(t?-1!==(t=this._hooks[e].indexOf(t))&&this._hooks[e].splice(t,1):this._hooks[e]=[])},e.prototype.emit=function(e,t,r){r?e&&(-1!==this._cache.indexOf(r)?this._emit(e,t):(this._hooksCache.hasOwnProperty(r)||(this._hooksCache[r]={}),this._hooksCache[r].hasOwnProperty(e)||(this._hooksCache[r][e]=[]),this._hooksCache[r][e].push(t))):this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&m(this._hooks[e]).forEach(function(e){try{e(t)}catch(e){}})},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),I=(D=+Date.now()+Number((""+Math.random()).slice(2,8)),(E={exports:{}}).exports=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var i in r)t[i]=r[i]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(i){function n(){}function o(t,r,o){if("undefined"!=typeof document){"number"==typeof(o=e({path:"/"},n.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var s=JSON.stringify(r);/^[\{\[]/.test(s)&&(r=s)}catch(e){}r=i.write?i.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in o)o[c]&&(a+="; "+c,!0!==o[c]&&(a+="="+o[c].split(";")[0]));return document.cookie=t+"="+r+a}}function s(e,r){if("undefined"!=typeof document){for(var n={},o=document.cookie?document.cookie.split("; "):[],s=0;s<o.length;s++){var a=o[s].split("="),c=a.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=t(a[0]);if(c=(i.read||i)(c,u)||t(c),r)try{c=JSON.parse(c)}catch(e){}if(n[u]=c,e===u)break}catch(e){}}return e?n[e]:n}}return n.set=o,n.get=function(e){return s(e,!1)},n.getJSON=function(e){return s(e,!0)},n.remove=function(t,r){o(t,"",e(r,{expires:-1}))},n.defaults={},n.withConverter=r,n}(function(){})}(),E.exports),A=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e.prototype.getCookie=function(e,t){return w(e)},e.prototype.setCookie=function(e,t,r,i){k(e,t,r,i)},e}(),P={getItem:function(e){try{var t=localStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(e){}return r||{}}catch(e){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,r)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return w(e)},setCookie:function(e,t,r,i){k(e,t,r,i)},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},B={getItem:function(e){try{var t=sessionStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(e){}return r||{}}catch(e){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,r)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return w(e)},setCookie:function(e,t,r,i){k(e,t,r,i)},isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},R=function(){function e(e,t){this._storage=t&&"session"===t?B:!e&&P.isSupportLS?P:new A}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,r,i){this._storage.setCookie(e,t,r,i)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),U=function(){function e(e,t,r){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=r}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,r=document.referrer,i=r?_(r).hostname:"",n=S(window.location.href),o=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web",n=(this.utm=function(e,t){var r=new R(!1,"session"),i=e?"_$utm_from_url_"+e:"_$utm_from_url",n={},o=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],s={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var a,c=!1;for(a in s)s[a]&&(-1!==o.indexOf(a)?(n.hasOwnProperty("tracer_data")||(n.tracer_data={}),n.tracer_data[a]=s[a]):n[a]=s[a],c=!0);c&&r.setItem(i,"1"),r.getItem(i)&&(n.hasOwnProperty("tracer_data")||(n.tracer_data={}),n.tracer_data.$utm_from_url=1)}catch(e){return s}return n}(this.appid,n,(this.domain,this.cookie_expire)),this.browser()),s=this.os();return{browser:n.browser,browser_version:n.browser_version,platform:o,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:r,referrer_host:i,utm:this.utm,latest_data:this.last(r,i)}},e.prototype.last=function(e,t){var r="",i="",n="",o=location.hostname,s=!1;return e&&t&&o!==t&&(i=t,s=!0,(o=S(r=e)).keyword)&&(n=o.keyword),{$latest_referrer:r,$latest_referrer_host:i,$latest_search_keyword:n,isLast:s}},e.prototype.browser=function(){var e,t="",r=""+parseFloat(this.appVersion),i=this.userAgent;return -1!==i.indexOf("Edge")||-1!==i.indexOf("Edg")?(t="Microsoft Edge",r=-1!==i.indexOf("Edge")?(e=i.indexOf("Edge"),i.substring(e+5)):(e=i.indexOf("Edg"),i.substring(e+4))):-1!==(e=i.indexOf("MSIE"))?(t="Microsoft Internet Explorer",r=i.substring(e+5)):-1!==(e=i.indexOf("Lark"))?(t="Lark",r=i.substring(e+5,e+11)):-1!==i.indexOf("Chrome")?-1!==(e=i.indexOf("TTWebView"))?(t="TTWebView",r=i.substring(e+10,e+23)):-1===(e=i.indexOf("Chrome"))&&-1===(e=i.indexOf("Chrome"))||(t="Chrome",r=i.substring(e+7)):-1!==i.indexOf("Safari")?-1!==(e=i.indexOf("Safari"))&&(t="Safari",r=i.substring(e+7),-1!==(e=i.indexOf("Version")))&&(r=i.substring(e+8)):-1!==(e=i.indexOf("Firefox"))&&(t="Firefox",r=i.substring(e+8)),{browser:t,browser_version:r=-1!==(i=(r=-1!==(i=(r=-1!==(i=r.indexOf(";"))?r.substring(0,i):r).indexOf(" "))?r.substring(0,i):r).indexOf(")"))?r.substring(0,i):r}},e.prototype.os=function(){for(var e="",t="",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"ChromeOS",r:/CrOS/},{s:"Linux",r:/(Linux|X11)/},{s:"Sun OS",r:/SunOS/}],i=0;i<r.length;i++){var n=r[i];if(n.r.test(this.userAgent)){"Mac OS X"===(e=n.s)&&this.isNewIpad()&&(e="iOS");break}}function o(e,t){return(e=e.exec(t))&&e[1]?e[1]:""}function s(e,t){return(e=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t))?e.slice(1)[0]:""}switch(/Windows/.test(e)&&(t=o(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":t=s("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":t=o(/Android ([\.\_\d]+)/,a=this.userAgent)||o(/Android\/([\.\_\d]+)/,a),e="android";break;case"iOS":t=this.isNewIpad()?s("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios";break;case"chromeOS":var a=this.userAgent.indexOf("x86_64"),t=this.userAgent.substring(a+7,a+16)}return{os_name:e,os_version:t}},e.prototype.getDeviceModel=function(e){var t,r,i="";try{"android"===e?navigator.userAgent.split(";").forEach(function(e){-1<e.indexOf("Build/")&&(i=e.slice(0,e.indexOf("Build/")))}):"ios"!==e&&"mac"!==e&&"windows"!==e||(i=this.isNewIpad()?"iPad":(r=(t=navigator.userAgent.replace("Mozilla/5.0 (","")).indexOf(";"),t.slice(0,r)))}catch(e){}return i.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&1<navigator.maxTouchPoints},e}(),M={sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"},F={va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",in:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},G={sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z21z1ez4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z24z18z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",in:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z24z18z49z23z21z1cz18z21z22z4ez18z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",ie2:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z1gz1cz4ez4az22z1gz1iz22z1mz1iz25z4az1cz23"},N={sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1gz1iz22z1mz1iz25z4az23z21",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1gz1iz22z1mz1iz24z4az23z21",ie:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z1gz1cz4az22z1gz1iz22z1mz1iz25z4az1cz23",ie2:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z1gz1cz4ez4az22z1gz1iz22z1mz1iz25z4az1cz23"},H=((T=ei=ei||{}).Init="init",T.Config="config",T.Start="start",T.Ready="ready",T.TokenComplete="token-complete",T.TokenStorage="token-storage",T.TokenFetch="token-fetch",T.TokenError="token-error",T.ConfigUuid="config-uuid",T.ConfigWebId="config-webid",T.ConfigDomain="config-domain",T.CustomWebId="custom-webid",T.TokenChange="token-change",T.TokenReset="token-reset",T.ConfigTransform="config-transform",T.EnvTransform="env-transform",T.SessionReset="session-reset",T.SessionResetTime="session-reset-time",T.Event="event",T.Events="events",T.EventNow="event-now",T.CleanEvents="clean-events",T.BeconEvent="becon-event",T.SubmitBefore="submit-before",T.SubmitScuess="submit-scuess",T.SubmitAfter="submit-after",T.SubmitError="submit-error",T.SubmitVerify="submit-verify",T.DestoryInstance="destory-instance",T.Stay="stay",T.ResetStay="reset-stay",T.StayReady="stay-ready",T.SetStay="set-stay",T.RouteChange="route-change",T.RouteReady="route-ready",T.Ab="ab",T.AbVar="ab-var",T.AbAllVars="ab-all-vars",T.AbConfig="ab-config",T.AbExternalVersion="ab-external-version",T.AbVersionChangeOn="ab-version-change-on",T.AbVersionChangeOff="ab-version-change-off",T.AbOpenLayer="ab-open-layer",T.AbCloseLayer="ab-close-layer",T.AbReady="ab-ready",T.AbComplete="ab-complete",T.AbTimeout="ab-timeout",T.Profile="profile",T.ProfileSet="profile-set",T.ProfileSetOnce="profile-set-once",T.ProfileUnset="profile-unset",T.ProfileIncrement="profile-increment",T.ProfileAppend="profile-append",T.ProfileClear="profile-clear",T.Autotrack="autotrack",T.AutotrackReady="autotrack-ready",T.CepReady="cep-ready",T.TracerReady="tracer-ready",T.sessionRecord="session-record",T.SessionRecordStart="session-record-start",T.SessionRecordPause="session-record-pause",T.SessionRecordEnd="session-record-end",T.SessionRecordReport="session-record-report",T.VisualCollectReady="visual-collect-ready",T.VisualApiReady="visual-api-ready",T.VisualApiUpdate="visual-api-update",(C=z=z||{}).DEBUGGER_MESSAGE="debugger-message",C.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",C.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",C.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",C.DEBUGGER_MESSAGE_EVENT="debugger-message-event",C.DEVTOOL_WEB_READY="devtool-web-ready",ei),L=void 0,t=(new Date).getTimezoneOffset(),K=parseInt(""+-t/60,10),q=60*t,V=function(){function e(e,t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var e=new U(t.app_id,t.cookie_domain||"",t.cookie_expire||6048e5).init(),r="__tea_cache_first_"+t.app_id,t=(this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new R(!1,"session"),this.localStorage=new R(!1,"local"),this.channelUrl="tcpy"===t.channel_type||"ttp"===t.channel_type?{WEBID_URL:"/v1/user/webid",TOB_URL:"",REPORT_URL:"/v1/list"}:{WEBID_URL:"/webid",TOB_URL:"/tobid",REPORT_URL:"/list"},t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage),this.localStorage.getItem(r));t&&1==t?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(r,"1")),this.envInfo={user:{user_unique_id:L,user_type:L,user_id:L,user_is_auth:L,user_is_login:L,device_id:L,web_id:L,ip_addr_id:L,user_unique_id_type:L},header:{app_id:L,app_name:L,app_install_id:L,install_id:L,app_package:L,app_channel:L,app_version:L,ab_version:L,os_name:e.os_name,os_version:e.os_version,device_model:e.device_model,ab_client:L,traffic_type:L,client_ip:L,device_brand:L,os_api:L,access:L,language:e.language,region:L,app_language:L,app_region:L,creative_id:e.utm.creative_id,ad_id:e.utm.ad_id,campaign_id:e.utm.campaign_id,log_type:L,rnd:L,platform:e.platform,sdk_version:"5.2.4_oversea",sdk_lib:"js",province:L,city:L,timezone:K,tz_offset:q,tz_name:L,sim_region:L,carrier:L,resolution:e.screen_width+"x"+e.screen_height,browser:e.browser,browser_version:e.browser_version,referrer:e.referrer,referrer_host:e.referrer_host,width:e.screen_width,height:e.screen_height,screen_width:e.screen_width,screen_height:e.screen_height,utm_term:e.utm.utm_term,utm_content:e.utm.utm_content,utm_source:e.utm.utm_source,utm_medium:e.utm.utm_medium,utm_campaign:e.utm.utm_campaign,tracer_data:JSON.stringify(e.utm.tracer_data),custom:{}}},this.ab_version="",this.ab_uuid_cache={},this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(e),this.initDomain(),this.initABData()}return e.prototype.initDomain=function(e){var t=this.initConfig.channel_domain;t?this.domain=t:(t=e||this.initConfig.channel,(e=(this.initConfig&&this.initConfig.channel_type?"tcpy"===this.initConfig.channel_type?G:N:M)[t])||(console.warn("current channel: "+t+" is not exist, use va instead, please check!!!!"),e=M.sg),this.domain=b(e))},e.prototype.setDomain=function(e){this.customDomain=!0,this.domain=e},e.prototype.getDomain=function(e){return this.customDomain||e&&this.initDomain(e),this.domain},e.prototype.initABData=function(){var e="__tea_sdk_ab_version_"+this.initConfig.app_id,e=this.localStorage.getItem(e);this.setAbCache(e)},e.prototype.setAbCache=function(e){this.ab_cache=e},e.prototype.getAbCache=function(){return this.ab_cache},e.prototype.clearAbCache=function(){this.ab_cache={},this.ab_version=""},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.setAbUuidCache=function(e,t){t=t||this.envInfo.user.user_unique_id,this.ab_uuid_cache[""+t]||(this.ab_uuid_cache[""+t]=[]),-1===this.ab_uuid_cache[""+t].indexOf(e)&&this.ab_uuid_cache[""+t].push(e)},e.prototype.getAbUuidCache=function(e){return this.ab_uuid_cache[""+e]},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.channelUrl.REPORT_URL;break;case"webid":t=this.channelUrl.WEBID_URL;break;case"tobid":t=this.channelUrl.TOB_URL}return e="",this.initConfig.caller&&(e="?sdk_version=5.2.4_oversea&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+e},e.prototype.setCustom=function(e){if(e&&e.latest_data&&e.latest_data.isLast)for(var t in delete e.latest_data.isLast,this.isLast=!0,e.latest_data)this.envInfo.header.custom[t]=e.latest_data[t]},e.prototype.setAppid=function(e){this.envInfo.header.app_id=e},e.prototype.set=function(e){var t=this;Object.keys(e).forEach(function(r){var i,n,o;void 0!==e[r]&&null!==e[r]||t.delete(r),"traffic_type"===r&&t.isLast&&(t.envInfo.header.custom.$latest_traffic_source_type=e[r]),"evtParams"===r?t.evtParams=y(y({},t.evtParams||{}),e.evtParams||{}):"_staging_flag"===r?t.evtParams=y(y({},t.evtParams||{}),{_staging_flag:e._staging_flag}):"reportErrorCallback"===r&&"function"==typeof e[r]?t.reportErrorCallback=e[r]:(o=n="",-1<r.indexOf(".")&&(n=(i=r.split("."))[0],o=i[1]),n?"user"===n||"header"===n?t.envInfo[n][o]=e[r]:t.envInfo.header.custom[o]=e[r]:Object.hasOwnProperty.call(t.envInfo.user,r)?-1<["user_type","ip_addr_id"].indexOf(r)?t.envInfo.user[r]=e[r]&&Number(e[r]):-1<["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(r)?t.envInfo.user[r]=e[r]&&String(e[r]):-1<["user_is_auth","user_is_login"].indexOf(r)?t.envInfo.user[r]=!!e[r]:"device_id"===r&&(t.envInfo.user[r]=e[r]):Object.hasOwnProperty.call(t.envInfo.header,r)?t.envInfo.header[r]=e[r]:t.envInfo.header.custom[r]=e[r])})},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error "),this.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message})}},e.prototype.setStore=function(e){try{var t,r;this.configPersist&&(t=this.storage.getItem(this.configKey)||{})&&Object.keys(e).length&&(r=Object.assign(e,t),this.storage.setItem(this.configKey,r))}catch(e){console.log("setStore error"),this.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message})}},e.prototype.getStore=function(){try{var e;return this.configPersist&&(e=this.storage.getItem(this.configKey)||{},Object.keys(e).length)?e:null}catch(e){return this.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message}),null}},e.prototype.delete=function(e){try{var t;this.configPersist&&(t=this.storage.getItem(this.configKey)||{})&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){this.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message}),console.log("delete error")}},e}(),W=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[Tea instance: "+this.name+"] "+e)},e.prototype.warn=function(e){this.isLog&&console.warn("%c %s","color: #4D1B00; background-color: #FF7D00;","[Tea instance: "+this.name+"] "+e)},e.prototype.error=function(e){this.isLog&&console.error("%c %s","color: #FFF; background-color: #F53F3F;","[Tea instance: "+this.name+"] "+e)},e.prototype.throw=function(e){throw this.error(this.name),Error(e)},e}(),J=function(){function e(){this.spiderBot=["Baiduspider","googlebot","360Spider","haosouspider","YoudaoBot","Yisouspider","Googlebot","Headless","Applebot","Bingbot","PetalBot"]}return e.prototype.checkSpider=function(e){var t,r;return!!e.enable_spider&&(!(t=window.navigator.userAgent)||(r=!1,this.spiderBot.forEach(function(e){-1!==t.indexOf(e)&&(r=!0)}),r))},e}(),X=function(){function e(e,t){this.collect=e,this.native=t}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},t.bridgeReady=function(){var e=this;return new Promise(function(t,r){try{e.bridgeInject()?AppLogBridge.hasStarted(function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):r(!1)}):r(!1)}catch(e){console.log("AppLogBridge, error:"+JSON.stringify(e.stack)),r(!1)}})},t.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(e){console.error("setNativeAppId error")}},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach(function(r){"user_unique_id"===r?t.setUserUniqueId(e[r]):e[r]?t.addHeaderInfo(r,e[r]):t.removeHeaderInfo(r)})}catch(e){console.error("setConfig error")}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){console.error("setUserUniqueId error")}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){console.error("addHeaderInfo error")}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){console.error("setHeaderInfo error")}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){console.error("removeHeaderInfo error")}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridge\u57CB\u70B9\u4E0A\u62A5",time:Date.now(),data:[{events:[{event:e,params:t}]}],code:200,status:"success"})}catch(e){console.error("onEventV3 error")}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){console.error("profileSet error")}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){console.error("profileSetOnce error")}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){console.error("profileIncrement error")}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){console.error("profileUnset error")}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){console.error("profileAppend error")}},e}(),Q=function(){function e(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.cacheStorgae=new R(!0),this.localStorage=new R(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=t.report_url||this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.refer_key="__tea_cache_refer_"+this.configManager.get("app_id"),this.collect.on(H.Ready,function(){r.reportAll(!1)}),this.collect.on(H.ConfigDomain,function(){r.reportUrl=r.configManager.getUrl("event")}),this.collect.on(H.Event,function(e){r.event(e)}),this.collect.on(H.BeconEvent,function(e){r.beconEvent(e)}),this.collect.on(H.CleanEvents,function(){r.reportAll(!1)}),this.linster()},e.prototype.linster=function(){var e,t=this;window.addEventListener("unload",function(){t.reportAll(!0)},!1),e=function(){t.reportAll(!0)},navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&t.reportAll(!0)},!1)},e.prototype.reportAll=function(e){this.report(e),this.reportBecon()},e.prototype.event=function(e){var t=this;try{var r,i=m(e,this.cacheStorgae.getItem(this.eventKey)||[]);this.cacheStorgae.setItem(this.eventKey,i),this.reportTimeout&&clearTimeout(this.reportTimeout),i.length>=this.maxReport?this.report(!1):(r=this.reportTime,this.reportTimeout=setTimeout(function(){t.report(!1),t.reportTimeout=null},r))}catch(e){this.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message})}},e.prototype.beconEvent=function(e){e=m(e,this.cacheStorgae.getItem(this.beconKey)||[]),this.cacheStorgae.setItem(this.beconKey,e),this.collect.destroy||this.collect.sdkStop||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},e.prototype.reportBecon=function(){var e;!this.collect.destroy&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(e=this.cacheStorgae.getItem(this.beconKey)||[])&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},e.prototype.report=function(e){var t;!this.collect.destroy&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(t=this.cacheStorgae.getItem(this.eventKey)||[]).length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))},e.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var r=0;r<e.length;r+=this.eventLimit){var i=e.slice(r,r+this.eventLimit),n=this.split(this.merge(i));this.send(n,t)}else n=this.split(this.merge(e)),this.send(n,t)},e.prototype.handleRefer=function(){var e,t="";try{t=(this.config.spa||this.config.autotrack)&&(e=this.localStorage.getItem(this.refer_key)||{}).routeChange?e.refer_key:this.configManager.get("referrer")}catch(e){t=document.referrer}return t},e.prototype.merge=function(e,t){var r=this,i=this.configManager.get(),n=i.header,o=i.user,s=(n.custom=JSON.stringify(n.custom),n.referrer=this.handleRefer(),this.configManager.get("evtParams")),a=this.configManager.get("user_unique_id_type"),i=e.map(function(e){try{Object.keys(s).length&&!t&&(e.params=y(y({},s),e.params)),a&&(e.params.$user_unique_id_type=a);var i,n,c=r.configManager.getAbCache(),u=o[r.config.ab_user_mode]||o.user_unique_id,l=r.configManager.getAbUuidCache(u);return c&&c.uuid&&c.uuid===u&&(i=r.configManager.getAbVersion(),r.config.enable_ab_uuid?l&&l.length&&(n=l.join(","),i)&&i.includes(n)&&(e.ab_sdk_version=i):i&&(e.ab_sdk_version=i)),e.session_id=r.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}catch(t){return r.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:t.message}),e}}),e=JSON.parse(JSON.stringify({events:i,user:o,header:n})),i=(e.local_time=Math.floor(Date.now()/1e3),e.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,e.verbose=1,[]);return i.push(e),i},e.prototype.split=function(e){return e.map(function(e){var t=[];return t.push(e),t})},e.prototype.send=function(e,t){var r=this;e.length&&!this.config.disable_track_event&&e.forEach(function(e){try{var i,n=JSON.parse(JSON.stringify(e)),o=(!r.config.filter||(n=r.config.filter(n))||console.warn("filter must return data !!"),r.collect.eventFilter&&n&&((n=r.collect.eventFilter(n))||console.warn("filterEvent api must return data !!")),n||e),s=JSON.parse(JSON.stringify(o));o.length&&(i=!0,o.forEach(function(e){e.events.length||(i=!1)}),i)&&(r.collect.emit(H.SubmitBefore,o),r.collect.emit(H.SubmitVerify,o),r.collect.requestManager.useRequest({url:r.reportUrl,data:o,success:function(e,t){e&&0!==e.e?(r.collect.emit(H.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),r.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_EVENT,info:"\u57CB\u70B9\u4E0A\u62A5\u5931\u8D25",time:Date.now(),data:s,code:e.e,failType:"\u6570\u636E\u5F02\u5E38\u5931\u8D25",status:"fail"})):(r.collect.emit(H.SubmitScuess,{eventData:t,res:e}),r.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_EVENT,info:"\u57CB\u70B9\u4E0A\u62A5\u6210\u529F",time:Date.now(),data:s,code:200,status:"success"}))},fail:function(e,t){r.configManager.get("reportErrorCallback")(e,t),r.collect.emit(H.SubmitError,{type:"f_net",eventData:e,errorCode:t}),r.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_EVENT,info:"\u57CB\u70B9\u4E0A\u62A5\u7F51\u7EDC\u5F02\u5E38",time:Date.now(),data:s,code:t,failType:"\u7F51\u7EDC\u5F02\u5E38\u5931\u8D25",status:"fail"})},timeout:r.timeout,useBeacon:!r.config.disable_sendbeacon&&t,withCredentials:r.enable_ttwebid}),r.collect.emit(H.SubmitAfter,o))}catch(e){console.warn("something error, "+JSON.stringify(e.stack)),r.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message})}})},e}(),$=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new R(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(H.ConfigUuid,function(e){r.setUuid(e)}),this.collect.on(H.ConfigWebId,function(e){r.setWebId(e)}),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e=this;this.cacheToken=this.storage.getItem(this.tokenKey)||{},this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(H.CustomWebId,function(){e.tokenReady=!0,e.collect.emit(H.TokenComplete)}):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:x(),user_unique_id:this.configManager.get("user_unique_id")||x()}):this.remoteWebid()},e.prototype.checkEnv=function(){var e=window.navigator.userAgent;return(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram"))&&!(!(e=S(window.location.href))||!e.Web_ID||(this.complete({web_id:""+e.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+e.Web_ID}),0))},e.prototype.remoteWebid=function(){var e=this,t=this.configManager.getUrl("webid"),r={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""},i=(this.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u53D1\u8D77WEBID\u8BF7\u6C42",logType:"fetch",level:"info",time:Date.now(),data:r}),x());this.collect.requestManager.useRequest({url:t,data:r,success:function(t){var r;t&&0===t.e?(r=t.web_id,e.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"WEBID\u8BF7\u6C42\u6210\u529F",logType:"fetch",level:"info",time:Date.now(),data:t})):(e.collect.configManager.set({localWebId:r=i}),e.collect.emit(H.TokenError),e.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"WEBID\u8BF7\u6C42\u8FD4\u56DE\u503C\u5F02\u5E38",logType:"fetch",level:"warn",time:Date.now(),data:t}),e.collect.logger.warn("appid: "+e.config.app_id+" get webid error, use local webid~")),e.complete({web_id:e.configManager.get("web_id")||r,user_unique_id:e.configManager.get("user_unique_id")||r})},fail:function(){e.complete({web_id:e.configManager.get("web_id")||i,user_unique_id:e.configManager.get("user_unique_id")||i}),e.collect.configManager.set({localWebId:i}),e.collect.emit(H.TokenError),e.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"WEBID\u8BF7\u6C42\u7F51\u7EDC\u5F02\u5E38",logType:"fetch",level:"error",time:Date.now(),data:null}),e.collect.logger.warn("appid: "+e.config.app_id+", get webid error, use local webid~")},timeout:3e5})},e.prototype.complete=function(e){var t=e.web_id,r=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:r}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(H.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",r=this.configManager.get("user_unique_id");(r||t)&&this.configManager.set({user_unique_id:r||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(H.TokenComplete)},e.prototype.setUuid=function(e){var t,r;e&&-1===["null","undefined","Null","None"].indexOf(e)?(e=String(e),t=this.configManager.get("user_unique_id"),r=this.cacheToken&&this.cacheToken.user_unique_id,e===t&&e===r||(this.configManager.set({user_unique_id:e}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=e,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(H.TokenChange,"uuid"),this.collect.emit(H.SessionReset))):this.clearUuid()},e.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(H.TokenReset))},e.prototype.setWebId=function(e){var t,r;e&&!this.config.enable_ttwebid&&(this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now(),t=this.configManager.get("web_id"),(r=this.configManager.get("user_unique_id"))&&r!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(H.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(H.TokenChange,"webid")),this.setStorage(this.cacheToken))},e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(){var e=this;return new Promise(function(t){"tcpy"!==e.config.channel_type&&"ttp"!==e.config.channel_type?e.collect.requestManager.useRequest({url:e.configManager.getUrl("tobid"),data:{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},success:function(e){e&&0===e.e?t(e.tobid):t("")},fail:function(){t("")},time:3e4,withCredentials:e.enable_ttwebid}):t("")})},e}(),Z=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.storage=new R(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSessionTimeCheck=t.disable_session_check,this.disableSession||(this.setSessionId(),this.collect.on(H.SessionReset,function(e){r.resetSessionId(e)}),this.collect.on(H.SessionResetTime,function(){r.updateSessionIdTime()}))},e.prototype.updateSessionIdTime=function(){var e,t=this.storage.getItem(this.sessionKey);t&&t.sessionId&&(e=t.timestamp,Date.now()-e>this.expireTime?t={sessionId:O(),timestamp:Date.now()}:t.timestamp=Date.now(),this.storage.setItem(this.sessionKey,t),this.resetExpTime())},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:O(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.disableSessionTimeCheck||(this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return!this.disableSession&&e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},e.prototype.resetSessionId=function(e){e={sessionId:e||O(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:O(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},e}(),Y=function(){function e(e,t){this.collector=e,this.config=t,this.requestType=t.request_type||"xhr",this.supportBeacon=!(!window.navigator||!window.navigator.sendBeacon),this.errorCode={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},this.customHeader=t.custom_request_header||{}}return e.prototype.useFetch=function(e){var t=e.url,r=e.data,i=e.method,n=e.success,o=e.fail,s={"Content-Type":"application/json; charset=utf-8"};if(Object.keys(this.customHeader).length)for(var a in this.customHeader)s[a]=this.customHeader[a];window.fetch?fetch(t,{method:i||"POST",headers:s,body:JSON.stringify(r)}).then(function(e){return e.json()}).then(function(e){n&&n(e)}).catch(function(e){o&&o(r,e)}):(this.requestType="xhr",console.log("your brwoser not support fetch, use xhr"),this.useRequest({url:t,data:r,method:i,success:n,fail:o}))},e.prototype.useBeacon=function(e){var t=e.url,r=e.data,i=e.success,e=e.fail;window.navigator.sendBeacon(t,JSON.stringify(r))?i&&i():e&&e(r,this.errorCode.BEACON_FALSE)},e.prototype.useRequest=function(e){var t=this,r=e.url,i=e.data,n=e.method,o=e.success,s=e.fail,a=e.timeout,c=e.useBeacon,u=e.withCredentials,l=e.app_key,f=e.forceXhr;if(c&&this.supportBeacon)this.useBeacon({url:r,data:i,method:n,success:o,fail:s});else if("fetch"!==this.requestType||f)try{var p=new XMLHttpRequest,h=n||"POST";if(p.open(h,""+r,!0),p.setRequestHeader("Content-Type","application/json; charset=utf-8"),l&&p.setRequestHeader("X-MCS-AppKey",""+l),Object.keys(this.customHeader).length)for(var d in this.customHeader)p.setRequestHeader(d,this.customHeader[d]);u&&(p.withCredentials=!0),a&&(p.timeout=a,p.ontimeout=function(){s&&s(i,t.errorCode.TIMEOUT)}),p.onload=function(){if(o){var e=null;if(p.responseText){try{e=JSON.parse(p.responseText)}catch(t){e={}}o(e,i)}}},p.onerror=function(){p.abort(),s&&s(i,t.errorCode.XHR_ON)},p.send(JSON.stringify(i))}catch(e){}else this.useFetch({url:r,data:i,method:n,success:o,fail:s})},e}(),ee=function(){function e(e,t){this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,t.enable_debug&&(this.collect=e,this.config=t,this.app_id=t.app_id,t=e.adapters.storage,this.cacheStorgae=new t(!1,"session"),this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load())}return e.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(e){console.log("devTool load fail, "+e.message)}},e.prototype.parseUrl=function(){var e={};try{var t=window.location.href.split("?")[1].split("&");t.length&&t.forEach(function(t){t=t.split("="),e[decodeURIComponent(t[0])]=decodeURIComponent(t[1])})}catch(e){}return e},e.prototype.load=function(){try{var e=this.parseUrl();if(e.open_devtool_web&&e.app_id){if(parseInt(e.app_id)!==this.app_id)return}else if(!this.getStorage())return;this.loadBaseInfo(),this.loadHook(),this.setStorage(),this.addLintener(),this.loadDebuggerModule(),this.loadDevTool()}catch(e){console.log("debug fail, "+e.message)}},e.prototype.getStorage=function(){var e=this.cacheStorgae.getItem("__applog_devtool_web");return e&&parseInt(e)===this.app_id},e.prototype.setStorage=function(){this.cacheStorgae.setItem("__applog_devtool_web",this.app_id)},e.prototype.loadDevTool=function(){this.loadScript("https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/devtool/debug-web.js")},e.prototype.loadBaseInfo=function(){var e=this;this.info=[{title:"\u57FA\u672C\u4FE1\u606F",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,\u4E0A\u62A5\u57DF\u540D:this.collect.configManager.getDomain(),SDK\u7248\u672C:"5.2.4_oversea",SDK\u5F15\u5165\u65B9\u5F0F:"npm"}},{title:"\u7528\u6237\u4FE1\u606F",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"\u70B9\u51FB\u83B7\u53D6SSID"}},{title:"\u516C\u5171\u53C2\u6570\u4FE1\u606F",type:2,infoName:{\u6D4F\u89C8\u5668:this.collect.configManager.get("browser"),\u6D4F\u89C8\u5668\u7248\u672C:this.collect.configManager.get("browser_version"),\u5E73\u53F0:this.collect.configManager.get("platform"),\u8BBE\u5907\u578B\u53F7:this.collect.configManager.get("device_model"),\u64CD\u4F5C\u7CFB\u7EDF:this.collect.configManager.get("os_name"),\u64CD\u4F5C\u7CFB\u7EDF\u7248\u672C:this.collect.configManager.get("os_version"),\u5C4F\u5E55\u5206\u8FA8\u7387:this.collect.configManager.get("os_version"),\u6765\u6E90:this.collect.configManager.get("referrer"),\u81EA\u5B9A\u4E49\u4FE1\u606F:""}},{title:"\u914D\u7F6E\u4FE1\u606F",type:3,infoName:{\u5168\u57CB\u70B9:!!this.config.autotrack,\u505C\u7559\u65F6\u957F:!!this.config.enable_stay_duration}},{title:"A/B\u914D\u7F6E\u4FE1\u606F",type:4,infoName:{"A/B\u5B9E\u9A8C":!!this.config.enable_ab_test}},{title:"\u5BA2\u6237\u7AEF\u4FE1\u606F",type:3,infoName:{\u6253\u901A\u5F00\u5173:!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(H.Ready,function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName["\u81EA\u5B9A\u4E49\u4FE1\u606F"]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["\u5DF2\u66DD\u5149VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/B\u57DF\u540D"]=e.config.ab_channel_domain||b(F[e.config.channel]),e.info[4].infoName["\u5168\u90E8\u914D\u7F6E"]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName["\u662F\u5426\u6253\u901A"]=!!e.collect.bridgeReport)})},e.prototype.loadHook=function(){var e=this;this.collect.on(z.DEBUGGER_MESSAGE,function(t){switch(t.type){case z.DEBUGGER_MESSAGE_SDK:var r={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(r.desc={content:JSON.stringify(t.data)}),e.updateLog(r),t.secType&&"AB"===t.secType?(e.info[4].infoName["\u5DF2\u66DD\u5149VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["\u5168\u90E8\u914D\u7F6E"]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case z.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var r=t.data[0],i=r.events;if(!i.length)return;i.forEach(function(r){r.checkShow=!0,r.searchShow=!0,r.success=t.status,r.type=-1!==e.filterEvent.indexOf(r.event)?"sdk":"cus",r.type=e.collect.bridgeReport?"bridge":r.type,r.info="","fail"===t.status&&(r.info={message:"code: "+t.code+"\uFF0C msg: "+t.failType})}),e.updateEvent(r)}return}})},e.prototype.addLintener=function(){var e=this;window.addEventListener("message",function(t){if(t.origin===location.origin){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;console.log("inittttt"),e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken(function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()})}})},e.prototype.sendData=function(e,t){try{(window.opener||window.parent).postMessage({type:e,payload:t},this.devToolOrigin)}catch(e){}},e.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},e.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},e.prototype.updateEvent=function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)},e.prototype.loadDebuggerModule=function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),e=(t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: absolute;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n      z-index:100;\n    }")),e.appendChild(t),document.createElement("div")),t=(e.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web">AppLog\u8C03\u8BD5</div>',document.createElement("div"));t.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(e),document.getElementsByTagName("body")[0].appendChild(t),document.getElementById("debugger-applog-web").addEventListener("click",function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)})},e}(),et={autotrack:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},tracer:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"},retry:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/retry.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/retry.js"},object:"LogRetry"},visual:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/visual.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/visual.js"},object:"LogVisual"}},er=["et","profile","heartbeat","monitor"],ei=function(){function e(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroy=!1,this.sdkReady=!1,this.adapters={},this.loadType="base",this.sdkStop=!1,this.name=e,this.hook=new j,this.remotePlugin=new Map,this.Types=H,this.adapters.storage=R}return e.usePlugin=function(t,r,i){if(r){for(var n=!1,o=0,s=e.plugins.length;o<s;o++)if(e.plugins[o].name===r){e.plugins[o].plugin=t,e.plugins[o].options=i||{},n=!0;break}n||e.plugins.push({name:r,plugin:t,options:i})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(e,t,r){e&&("full"===this.loadType&&er.includes(e)?console.info("your sdk version has "+e+" already ~"):t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:r}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},e.prototype.init=function(t){var r,i=this;try{r=JSON.parse(JSON.stringify(t))}catch(e){r=t}this.logger=new W(this.name,r.log),this.inited?this.logger.warn("[instance: "+this.name+"], every instance's api: init,  can be call only one time!"):r&&v(r)?r.app_id&&"number"==typeof(t=r.app_id)&&!isNaN(t)?r.app_key&&"string"!=typeof r.app_key?this.logger.warn("app_key param is error, must be string, please check!"):(t=["sg","va","in","ie","ie2"],r.channel_domain||-1!==t.indexOf(r.channel)||(this.logger.warn("your channel: "+r.channel+" is not exist. channel must be one of "+t.join(",")+", use sg instead, please check!!!"),r.channel="sg"),this.spider=new J,this.spider.checkSpider(r)?this.logger.warn("The current environment may be a spider, can not report!"):(this.appBridge=new X(this,r.enable_native),this.requestManager=new Y(this,r),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new V(this,r),this.debugger=new ee(this,r),this.initConfig=r,this.emit(H.Init),this.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884CINIT",data:r,level:"info",time:Date.now()}),r.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.setAppid(r.app_id),this.eventManager=new Q,this.tokenManager=new $,this.sessionManager=new Z,Promise.all([new Promise(function(e){i.once(H.TokenComplete,function(){e(!0)})}),new Promise(function(e){i.once(H.Start,function(){e(!0)})})]).then(function(){try{e.plugins.reduce(function(e,t){var r=t.plugin,t=t.options,t=Object.assign(i.initConfig,t),r=new r;return r.apply(i,t),e.push(r),e},i.pluginInstances)}catch(e){console.warn("load plugin error, "+e.message),i.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message})}i.sdkReady=!0,i.emit(H.Ready),i.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u521D\u59CB\u5316\u5B8C\u6210",time:Date.now(),level:"info",data:i.configManager.get("user")}),i.logger.info("appid: "+r.app_id+", userInfo:"+JSON.stringify(i.configManager.get("user"))),i.logger.info("appid: "+r.app_id+", sdk is ready, version is 5.2.4_oversea, you can report now !!!"),r.disable_auto_pv&&(i.disableAutoPageView=!0);try{("full"===i.loadType&&r.enable_ab_test||r.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){i.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message})}i.pageView(),i.on(H.TokenChange,function(e){"webid"===e&&i.pageView(),i.logger.info("appid: "+r.app_id+" token change, new userInfo:"+JSON.stringify(i.configManager.get("user"))),i.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u8BBE\u7F6E\u4E86\u7528\u6237\u4FE1\u606F",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})}),i.on(H.TokenReset,function(){i.logger.info("appid: "+r.app_id+" token reset, new userInfo:"+JSON.stringify(i.configManager.get("user"))),i.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u91CD\u7F6E\u4E86\u7528\u6237\u4FE1\u606F",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})}),i.on(H.RouteChange,function(e){e.init||r.disable_route_report||i.pageView()})}),this.tokenManager.apply(this,r),this.eventManager.apply(this,r),this.sessionManager.apply(this,r)),this.inited=!0)):this.logger.warn("app_id param is error, must be number, please check!"):this.logger.warn("init params error,please check")},e.prototype.config=function(e){if(this.inited){if(e&&v(e)){var t,r;try{t=JSON.parse(JSON.stringify(t))}catch(r){t=e}this.bridgeReport?this.appBridge.setConfig(t):(t._staging_flag&&1===t._staging_flag&&(this.staging=!0),t.disable_auto_pv&&(this.disableAutoPageView=!0,delete t.disable_auto_pv),e=y({},t),this.initConfig&&this.initConfig.configPersist&&((r=this.configManager.getStore())&&(e=Object.assign(r,t)),this.configManager.setStore(t)),e.web_id,e.user_unique_id,r=function(e,t){var r={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&(r[n[i]]=e[n[i]]);return r}(e,["web_id","user_unique_id"]),e.hasOwnProperty("web_id")&&this.emit(H.ConfigWebId,e.web_id),e.hasOwnProperty("user_unique_id")&&this.emit(H.ConfigUuid,e.user_unique_id),this.configManager.set(r),this.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884CCONFIG",level:"info",time:Date.now(),data:e}))}else console.warn("config params is error, please check")}else console.warn("config must be use after function init")},e.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(H.ConfigDomain)},e.prototype.getConfig=function(e){return this.configManager.get(e)},e.prototype.send=function(){this.start()},e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(H.Start),this.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884CSTART",level:"info",time:Date.now()}),this.bridgeReport)&&(this.pageView(),this.emit(H.Ready))},e.prototype.event=function(e,t){var r=this;try{var i=[];if(Array.isArray(e))e.forEach(function(e){(e=r.processEvent(e[0],e[1]||{}))&&i.push(e)});else{var n=this.processEvent(e,t);if(!n)return;i.push(n)}this.bridgeReport?i.forEach(function(e){var t=e.event,e=e.params;r.appBridge.onEventV3(t,JSON.stringify(e))}):i.length&&(this.emit(H.Event,i),this.emit(H.SessionResetTime))}catch(e){this.logger.warn("something error, please check"),this.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message})}},e.prototype.beconEvent=function(e,t){var r;Array.isArray(e)?this.logger.warn("beconEvent not support batch report, please check"):(r=[],(e=this.processEvent(e,t||{}))&&(r.push(e),r.length)&&(this.emit(H.BeconEvent,r),this.emit(H.SessionResetTime)))},e.prototype.beaconEvent=function(e,t){this.beconEvent(e,t)},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{var r,i,n;return e?(/^event\./.test(r=e)&&(r=e.slice(6)),n=void((i="object"!=typeof(i=t)?{}:i).profile?delete i.profile:i.event_index=D+=1),i.local_ms?(n=i.local_ms,delete i.local_ms):n=+new Date,{event:r,params:i,local_time_ms:n,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}):(console.warn("eventName is null\uFF0C please check"),null)}catch(r){return this.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:r.message}),{event:e,params:t}}},e.prototype.filterEvent=function(e){this.eventFilter=e},e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=function(e,t,r){this.hook.emit(e,t,r)},e.prototype.set=function(e){this.hook.set(e)},e.prototype.stop=function(){this.sdkStop=!0},e.prototype.reStart=function(){this.sdkStop=!1},e.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},e.prototype.predefinePageView=function(e){var t;void 0===e&&(e={}),this.inited?(t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+(this.configManager&&this.configManager.is_first_time||!1)},t=y(y({},t),e),this.event("predefine_pageview",t)):console.warn("predefinePageView should call after init")},e.prototype.clearEventCache=function(){this.emit(H.CleanEvents)},e.prototype.setWebId=function(e){this.config({web_id:""+e})},e.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},e.prototype.getSessionId=O,e.prototype.setSessionId=function(e){this.emit(H.SessionReset,e)},e.prototype.resetStayDuration=function(e,t,r){this.emit(H.ResetStay,{url_path:e,title:t,url:r},H.Stay)},e.prototype.resetStayParams=function(e,t,r){this.emit(H.SetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:r=void 0===r?"":r},H.Stay)},e.prototype.getToken=function(e,t){var r,i,n,o=this;this.inited?(r=!1,i=function(t){var i;if(!r)return r=!0,i=o.configManager.get().user,t&&(i.tobid=t,i["diss".split("").reverse().join("")]=t),e(y({},i))},n=function(){o.tokenManager.getTobId().then(function(e){i(e)})},this.sdkReady?n():(t&&setTimeout(function(){i()},t),this.on(H.Ready,function(){n()}))):console.warn("predefinePageView should call after init")},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(H.ProfileSet,e,H.Profile),this.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884CprofileSet",level:"info",time:Date.now(),data:e})},e.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(H.ProfileSetOnce,e,H.Profile),this.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884CprofileSetOnce",level:"info",time:Date.now(),data:e})},e.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(H.ProfileIncrement,e,H.Profile),this.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884CprofileIncrement",level:"info",time:Date.now(),data:e})},e.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(H.ProfileUnset,e,H.Profile),this.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884CprofileUnset",level:"info",time:Date.now(),data:e})},e.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(H.ProfileAppend,e,H.Profile),this.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884CprofileAppend",level:"info",time:Date.now(),data:e})},e.prototype.setExternalAbVersion=function(e){this.emit(H.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,H.Ab)},e.prototype.getVar=function(e,t,r,i){this.emit(H.AbVar,{name:e,defaultValue:t,callback:r,uuid:i},H.Ab)},e.prototype.getABconfig=function(e,t){this.emit(H.AbConfig,{params:e,callback:t},H.Ab)},e.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(H.AbVersionChangeOn,e,H.Ab),function(){t.emit(H.AbVersionChangeOff,e,H.Ab)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(H.AbVersionChangeOff,e,H.Ab)},e.prototype.openOverlayer=function(){this.emit(H.AbOpenLayer,"",H.Ab)},e.prototype.closeOverlayer=function(){this.emit(H.AbCloseLayer,"",H.Ab)},e.prototype.getAllVars=function(e){this.emit(H.AbAllVars,e,H.Ab)},e.prototype.destoryInstace=function(){this.destroy||(this.destroy=!0,this.off(H.TokenComplete),this.emit(H.DestoryInstance))},e.prototype.destroyInstance=function(){this.destroy||(this.destroy=!0,this.off(H.TokenComplete),this.emit(H.DestoryInstance))},e.plugins=[],e}(),t=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;t.event_verify_url&&("string"==typeof t.event_verify_url?(this.url=t.event_verify_url+"/v1/list_test",this.url&&(t=e.Types,e.on(t.SubmitBefore,function(t){e.requestManager.useBeacon({url:r.url,data:t})}))):console.log("please use correct et_test url"))},e}(),en=function(){function e(){var e=this;this.setInterval=function(){var t,r,i,n;e.clearIntervalFunc=(t=function(){e.isSessionhasEvent&&e.endCurrentSession()},r=e.sessionInterval,void 0===t&&(t=function(){}),void 0===r&&(r=1e3),i=Date.now()+r,n=window.setTimeout(function e(){var o=Date.now()-i;t(),i+=r,n=window.setTimeout(e,Math.max(0,r-o))},r),function(){window.clearTimeout(n)})},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}return e.prototype.apply=function(e,t){var r=this;this.collect=e,t.disable_heartbeat||(this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval(),e=this.collect.Types,this.collect.on(e.SessionReset,function(){r.process()}))},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},e.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},e}(),eo=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.config.channel_domain||t.disable_track_event||t.disable_sdk_monitor||(this.url=e.configManager.getUrl("event"),t=this.collect.Types,this.collect.on(t.Ready,function(){r.sdkOnload()}),this.collect.on(t.SubmitError,function(e){var t=e.type,i=e.eventData,e=e.errorCode;"f_data"===t&&r.sdkError(i,e)}))},e.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),r=t.header,i=t.user,n=r.app_id,o=r.app_name,s=r.sdk_version,a=i.web_id,c={events:[{event:"onload",params:JSON.stringify({app_id:n,app_name:o||"",sdk_version:s,sdk_type:"npm",sdk_config:this.config,sdk_desc:"TOC_OVERSEA"}),local_time_ms:Date.now()}],user:{user_unique_id:a},header:{}};setTimeout(function(){e.collect.requestManager.useRequest({url:e.url,data:[c],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})},16)}catch(e){}},e.prototype.sdkError=function(e,t){var r=this;try{var i=e[0],n=i.user,o=i.header,s=[],a=(e.forEach(function(e){e.events.forEach(function(e){s.push(e)})}),{events:s.map(function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:o.app_id,app_name:o.app_name||"",error_event:e.event,sdk_version:o.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(o),user:JSON.stringify(n)}),local_time_ms:Date.now()}}),user:{user_unique_id:n.user_unique_id},header:{}});setTimeout(function(){r.collect.requestManager.useRequest({url:r.url,data:[a],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})},16)}catch(e){}},e}(),es="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null,ea=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach(function(t,r){var i,n;"sdk"===t?et.hasOwnProperty(r)?(i=et[r].object,n=""+et[r].src[e.channel],e.exist(r,i,n)):console.warn("your "+r+" is not exist\uFF0Cplease check plugin name"):"object"==typeof t&&(t.src?e.exist(r,t.call,t.src):e.process(r,t.instance,"INSTANCE"))})}catch(e){this.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message}),console.log("load extend error")}},e.prototype.exist=function(e,t,r){var i=this;es[t]?(this.process(e,es[t]),console.log("\u5DF2\u6709"+e+"\u63D2\u4EF6\uFF0C\u907F\u514D\u91CD\u590D\u52A0\u8F7D~")):this.loadPlugin(e,r,function(){i.process(e,es[t]),console.log(" %c %s %s %s","color: yellow; background-color: black;","\u2013","load plugin:"+e+" success","-")},function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","\u2013","load plugin:"+e+" error","-")})},e.prototype.process=function(e,t,r){try{var i;r?((i=new t).apply&&i.apply(this.collect,this.config),console.log("excude "+e+" success")):t&&t(this.collect,this.config)}catch(t){this.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:t.message}),console.log("excude "+e+" error, message:"+t.message)}},e.prototype.loadPlugin=function(e,t,r,i){var n=this;try{var o=document.createElement("script");o.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(r),o.onerror=function(){i(t)},o.onload=function(){n._plugin[e].forEach(function(e){e()})},document.getElementsByTagName("head")[0].appendChild(o)}catch(e){this.collect.emit(z.DEBUGGER_MESSAGE,{type:z.DEBUGGER_MESSAGE_SDK,info:"\u53D1\u751F\u4E86\u5F02\u5E38",level:"error",time:Date.now(),data:e.message})}},e}(),ea=(ei.usePlugin(ea,"extend"),ei.usePlugin(t,"et"),ei.usePlugin(en,"heartbeat"),ei.usePlugin(eo,"monitor"),new ei("default")),ec=ea,eu={selectRoute:900,browserError:1e3,crc32:1e3,preUpload:1001,initUploadID:1002,process:1003,fileMerge:1004,complete:1005},el="video",ef="image",ep="object",eh={video:"video_upload",image:"image_upload",object:"object_upload"},ed="imagex";function eg(e){return(eg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ey(){return(ey=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function em(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!=eg(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=eg(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"==eg(i)?i:i+""),n)}}var ev=(i=function e(t,r){switch(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.context=r,this.teaLog=ec,this.options.region){case"us-east-1":case"us-east-2":case"us-east-5":case"us-east-red":case"gcp":case"US-TTP":default:this.tea_app_id=2643,this.tea_channel="va";break;case"boei18n":case"ap-singapore-1":this.tea_app_id=2643,this.tea_channel="sg"}if(t={app_id:this.tea_app_id,channel:this.tea_channel,log:!1,disable_sdk_monitor:!0,disable_auto_pv:!0},r=this.options.teaConfig)try{t=ey(t,r)}catch(e){console.warn("[BytedUpload]: tea user config invalid!")}this.teaLog.init(ey(t,r)),this.teaLog.config({evtParams:{sdk_version:"2.0.12"}}),this.setLineAppId(this.options.appId),this.setUserUniqueId(this.options.userId),this.teaLog.start()},n=[{key:"send",value:function(e){var t=this.context,r=e.key,t=t.tasks[r],i=eu[e.stage]||999,t=e.fileType||t&&t.fileType,n=e.fileSize||0,o={log_type:eh[t],stage:i,fk:r,fs:n,req:e.req,res:e.res,ts:Math.round(Date.now()/1e3),sst:e.stageStartTime,set:e.stageEndTime,dur:e.duration,tdur:e.totalDuration,durs:e.duration/1e3,tdurs:e.totalDuration/1e3,eslr:e.enableSelectRoute,ucsrr:e.useClientSelectRouteResult,skipCommit:!!e.skipCommit,errc:null==(r=e.extra)?void 0:r.errorCode,err:null==(r=e.extra)?void 0:r.error,msg:null==(r=e.extra)?void 0:r.message},r=e.type,r="error"===r||"retry"===r?r:i,s="".concat("image"===t?"image":"video","_")+r;switch(i){case 1e3:this.teaLog.event(s,ey({},o,{type:e.type,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,crc32Array:e.crc32Array,isDirect:e.isDirect})}));break;case 1001:this.teaLog.event(s,ey({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,err:e.extra&&e.extra.error,msg:e.extra&&e.extra.message,sig:e.signature,stk:e.proxyStsToken})}));break;case 1002:this.teaLog.event(s,ey({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,upid:e.uploadID})}));break;case 1003:e.isAllFinish||e.isDirect||(delete o.sst,delete o.set,delete o.dur),this.teaLog.event(s,ey({},o,{type:e.type,oid:e.oid,errc:e.extra&&e.extra.errorCode,upload_host:e.tosDomain,af:e.isAllFinish,cst:e.crc32StartTime,cet:e.crc32EndTime,cdur:e.crc32Duration,slst:e.sliceStartTime,slet:e.sliceEndTime,sldurs:e.sliceDuration&&e.sliceDuration/1e3,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message,si:e.sliceIndex,af:e.isAllFinish})}));break;case 1004:default:this.teaLog.event(s,ey({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,msg:e.extra&&e.extra.message})}));break;case 1005:this.teaLog.event(s,ey({},o,{type:e.type,oid:e.oid,upload_host:e.tosDomain,errc:e.extra&&e.extra.errorCode,speed:Math.round(n/(e.totalDuration/1e3)/1024),ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,err:e.extra&&e.extra.error,msg:e.extra&&e.extra.message,vid:e.uploadResult&&e.uploadResult.Vid})}));break;case 900:this.teaLog.event(s,ey({},o,{type:e.type,errc:e.extra&&e.extra.errorCode,race_info:e.raceInfo,client_ip:e.lastClientIp,uc:e.useCache,ex:JSON.stringify({errc:e.extra&&e.extra.errorCode,err:e.extra&&e.extra.error,msg:e.extra&&e.extra.message})}))}}},{key:"setLineAppId",value:function(e){this.teaLog.config({evtParams:{line_app_id:e}})}},{key:"setUserUniqueId",value:function(e){this.teaLog.config({user_unique_id:e})}},{key:"console",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){this.options.debug&&console.log(e)})}],em(i.prototype,n),o&&em(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i),t=r(6),eb=r.n(t),en=r(4),e_=r.n(en),eS={urlTemplate:function(e,t){var r;return Object.keys(t=t||{}).forEach(function(i){r=RegExp("{".concat(i,"}"),"g"),e=e.replace(r,t[i])}),e},toQueryString:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map(function(t){return"".concat(t,"=").concat(encodeURIComponent(e[t]))}).join("&")},supportChunked:function(){var e=window.Blob||window.WebKitBlob;try{var t=e.prototype;return!(!FormData||!(t.slice||t.webkitSlice||t.mozSlice))}catch(e){return!1}},supportXhr:function(){return!!window.FormData||window.ProgressEvent&&window.FileReader},supportCrc32:function(){var e=window.FileReader&&window.FileReader.prototype.readAsBinaryString;return"undefined"!=typeof Int32Array&&e&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice)},storage:function(e){var t=e,e={removeItem:function(e){delete t.cache[e]},setItem:function(e,r){t.cache[e]=r},getItem:function(e){return t.cache[e]},clear:function(){delete t.cache,t.cache={}}};if(!(1<arguments.length&&void 0!==arguments[1])||arguments[1])try{if(window.localStorage)return window.localStorage.setItem("",""),window.localStorage}catch(e){}return e},noop:function(){},getUnique:function(e){return"".concat(e,"_").concat((new Date).getTime(),"_").concat(parseInt(1e6*Math.random()))},getFileSliceLength:function(e,t){var r=e.size;return t&&"function"==typeof t?2097152>t(r)?2097152:t(r)||r:209715200<r?10485760:r<=209715200&&2097152<=r?5242880:e.size},getFileSuffix:function(e){if(e&&"[object String]"===Object.prototype.toString.call(e)){var t=e.lastIndexOf(".");if(0<t&&(e="."+e.substring(t+1)).length<=8)return e}},fileSlice:function(e,t,r){return(e.slice||e.webkitSlice||e.mozSlice).call(e,t,r)},getPathByURL:function(e){return/^(?:(https?\:)\/\/)?(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/.exec(e)[5]||"/"},crypto:{hmac:function(e,t){return eb()(t,e)},sha256:function(e){return e_()(e)}},date:{iso8601:function(e){return(e=void 0===e?eS.date.getDate():e).toISOString().replace(/\.\d{3}Z$/,"Z")}},Buffer:Uint8Array,generateKey:function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=r.length,n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*i));return t}};function ew(e){return(ew="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ek(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!=ew(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=ew(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"==ew(i)?i:i+""),n)}}function ex(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ex=function(){return!!e})()}function eO(e){return(eO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function eE(e,t){return(eE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var eT=function(){var e,t,r;function i(){var e,t,r,n;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(t=this,r=eO(r=i),e=function(e,t){if(t&&("object"===ew(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(t,ex()?Reflect.construct(r,n||[],eO(t).constructor):r.apply(t,n))).xhr=new XMLHttpRequest,e._data=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eE(e,t)}(i,p.a),e=i,t=[{key:"_ajax",value:function(e){var t=this,r=this.xhr;r.upload.onprogress=function(e){t.emit("progress",e)},r.onreadystatechange=function(i){4===r.readyState&&(r.upload.onprogress=eS.noop,r.onreadystatechange=eS.noop,r.params=e,t._data&&t._data.url&&(r.currentUrl=t._data.url),200<=r.status&&r.status<300?t.emit("complete",r):400<=r.status&&t.emit("error",r))},r.onerror=function(){r.errText="unknow net error",t.emit("error",r)},r.ontimeout=function(){r.errText="timeout",t.emit("error",r)},r.onabort=function(){r.errText="abort",t.emit("error",r)},r.send(e)}},{key:"send",value:function(e){var t=this;return this._data=e,this.xhr.open(e.method||"POST",e.url||"",!0),e.headers&&Object.keys(e.headers).forEach(function(r){t.xhr.setRequestHeader(r,e.headers[r])}),this.xhr.timeout=e.timeout||0,e.ontimeout&&(this.xhr.ontimeout=e.ontimeout),e.binary?this.sendAsBinary(e):e.custom?"object"===ew(e.custom)?this.sendAsCustom(JSON.stringify(e.custom)):"none"===e.custom?(delete e.custom,this.sendAsCustom()):this.sendAsCustom(e.custom):this.sendAsFormData(e)}},{key:"sendAsBinary",value:function(e){return this.xhr.setRequestHeader("Content-Type","application/octet-stream"),this.xhr.setRequestHeader("Content-Disposition",'attachment; filename="'.concat(encodeURI(e.filename),'"')),this._ajax(e.file)}},{key:"sendAsFormData",value:function(e){t=(t=e.formData?"function"==typeof e.formData?e.formData():e.formData:t)||[];for(var t,r=new FormData,i=0,n=t.length;i<n;i++){var o=r[i];r.append(o.name,o.value)}return e.file&&r.append(e.field,e.file,e.name),this._ajax(r)}},{key:"sendAsCustom",value:function(e){return this._ajax(e)}},{key:"abort",value:function(){this.xhr.onreadystatechange=eS.noop,this.xhr.abort()}},{key:"getResponse",value:function(){return this.xhr.response}},{key:"getText",value:function(){return this.xhr.responseText}},{key:"getJson",value:function(){return JSON.parse(this.xhr.responseText)}}],ek(e.prototype,t),r&&ek(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(),eo=r(1),eC=r.n(eo); window['eC']=eC;function eD(e){return(eD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ez(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function ej(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ez(Object(r),!0).forEach(function(t){var i,n,o;i=e,n=t,o=r[t],(n=eP(n))in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ez(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function eI(){return(eI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function eA(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,eP(i.key),i)}}function eP(e){return e=function(e,t){if("object"!=eD(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=eD(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==eD(e)?e:e+""}function eB(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(eB=function(){return!!e})()}function eR(e){return(eR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function eU(e,t){return(eU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var eM=function(){var e,t,r;function i(e,t){var r,n,o,s;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(n=this,o=eR(o=i),r=function(e,t){if(t&&("object"===eD(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(n,eB()?Reflect.construct(o,s||[],eR(n).constructor):o.apply(n,s))).options=e,r.config=t,r.uploaderCtx=e.context,r.file=e.file,r.cacheKey="__bd_uploader_cache",r}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eU(e,t)}(i,p.a),e=i,t=[{key:"start",value:function(e,t){this._st=Date.now(),this.uploaderCtx._broadcast("startSelectRoute",null,!0),this.clientIp=e.clientIp,this.selectRouteTimeout=e.selectRouteTimeout||5e3,this.selectRouteCacheTime=e.selectRouteCacheTime||36e5,this.selectRouteFileSize=e.selectRouteFileSize||2097152,this.completeCallback=t,(e=this.checkSelect({clientIp:this.clientIp}))?this.success(e,null,!0):this.startSelectRoute()}},{key:"checkSelect",value:function(e){var e=e.clientIp,t=null;try{t=JSON.parse(this.uploaderCtx.storage.getItem(this.cacheKey))}catch(e){return null}if(t){var r=t.lastClientIp,i=t.lastSelectRouteTime;if(e&&e!==r)return null;if((new Date).getTime()-i<this.selectRouteCacheTime)return t}return null}},{key:"startSelectRoute",value:function(){var e=this,t=this.config.region,r=new eT,i=(r.on("complete",function(t){if(t.response)try{var r,i=JSON.parse(t.response);i.ResponseMetadata.Error?e.fail({xhr:t,errorCode:i.ResponseMetadata.Error.CodeN,error:i.ResponseMetadata.Error.Code,message:i.ResponseMetadata.Error.Message}):(r=i.Result.Domains,e.race(r,t))}catch(r){e.fail({error:"catch error: ".concat(r.toString()),xhr:t})}else e.fail({error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t})}),r.on("error",function(t){var r={error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t};t.response&&(t=JSON.parse(t.response)).ResponseMetadata&&t.ResponseMetadata.Error&&(r.errorCode=t.ResponseMetadata.Error.CodeN,r.error=t.ResponseMetadata.Error.Code,r.message=t.ResponseMetadata.Error.Message),e.fail(r)}),this.config.videoHost),n=this.config.videoConfig&&this.config.videoConfig.spaceName,n={Action:"GetUploadCandidates",Version:"2020-11-19",SpaceName:n=this.options.type===ep&&this.config.objectConfig&&this.config.objectConfig.spaceName?this.config.objectConfig.spaceName:n},o=this.options.stsToken,s=eS.toQueryString(n),a=o.AccessKeyID,c=o.AccessKeyId,u=o.SecretAccessKey,l=o.SessionToken,o=o.CurrentTime,i={method:"GET",url:"".concat(i,"?").concat(s),timeout:3e4,region:t,params:n},s=new eC.a(i,"vod"),t=(this.config.useServerCurrentTime&&6e4<Math.abs(new Date(o)-new Date)&&(this.systemTimeGap=new Date(o)-new Date),this.systemTimeGap?new Date((new Date).getTime()+this.systemTimeGap):new Date);s.addAuthorization({accessKeyId:c||a,secretAccessKey:u,sessionToken:l},t),r.send(i)}},{key:"race",value:function(e,t){var r=this,i=this.file,n=(i.slice||i.webkitSlice||i.mozSlice).call(i,0,Math.min(this.selectRouteFileSize,i.size)),o=e.map(function(e){return{domainName:e.Name,domainInfo:e,percent:0,startTime:(new Date).getTime(),endTime:(new Date).getTime(),complete:!1}}),s=0,a=o.length;o.forEach(function(e,i){var n=new eT;n.on("complete",function(){o[i].endTime=(new Date).getTime(),o[i].complete=!0,o.forEach(function(e,t){i!==t&&e.transport&&e.transport.abort()}),r.formatRaceInfo(o,t)}),n.on("error",function(e){o[i].endTime=(new Date).getTime(),o[i].complete=!0,o[i].error=e.errText,a<=++s&&r.formatRaceInfo(o,t)}),n.on("progress",function(e){e=e.loaded/e.total,o[i].percent=e}),o[i].transport=n}),o.forEach(function(e){var t=e.domainInfo,i={oid:t.StoreID,tosDomain:"".concat(r.config.schema,"://").concat(t.Name)},i=eS.urlTemplate(d,i)+"?speedtest",t=t.Sign;e.transport.send({method:"post",url:i,headers:{Authorization:t,"Content-CRC32":"ignore"},file:n,binary:1,timeout:r.selectRouteTimeout})})}},{key:"formatRaceInfo",value:function(e,t){e.sort(function(e,t){return e.percent<t.percent?1:e.percent>t.percent?-1:e.error?1:t.error?-1:0}),e.forEach(function(e){delete e.transport}),e={lastClientIp:this.clientIp,lastSelectRouteTime:(new Date).getTime(),raceInfo:e,type:"success"},this.uploaderCtx.storage.setItem(this.cacheKey,JSON.stringify(e)),this.success(e,t)}},{key:"success",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],t=t&&this.formatXhr(t);this.uploaderCtx.logger.send(eI(ej(ej({stage:"selectRoute",stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,fileSize:this.file&&this.file.size},t),{},{useCache:r}),e)),this.uploaderCtx._broadcast("completeSelectRoute",ej(ej({},e),{},{useCache:r}),!0),this.completeCallback({selectRouteResult:e.raceInfo})}},{key:"fail",value:function(e){var t={error:e.error,errorCode:e.errorCode,message:e.message};this.uploaderCtx.logger.send(eI(ej({stage:"selectRoute",stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,fileSize:this.file&&this.file.size,extra:t,type:"warn"},this.formatXhr(e.xhr)))),this.uploaderCtx._broadcast("completeSelectRoute",ej({type:"warn"},t),!0),this.completeCallback()}},{key:"formatXhr",value:function(e){return{req:{url:e.currentUrl,param:e.params},res:{status:e.status,header:e.getAllResponseHeaders(),body:e.responseText}}}}],eA(e.prototype,t),r&&eA(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(),eF={crc32:function(e,t){for(var r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],i=("undefined"!=typeof Int32Array&&(r=new Int32Array(r)),-1^~~t),n=(e=new Uint8Array(e)).length,o=0;o<n;o++)i=r[255&(i^e[o])]^i>>>8;return(-1^i)>>>0},dec2hex:function(e){if(void 0!==e)return function e(t){return t.length<8?e(t="0".concat(t)):t}(Number(e).toString(16))}};function eG(e){return(eG="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eN(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!=eG(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=eG(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"==eG(i)?i:i+""),n)}}var eH=(s=function e(t,r,i,n){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e),this.file=t,this.successProcess=i,this.failProcess=n,this.sliceLength=r,this.retryTime=0,this.fileSize=t.size,this.crc32Array=[]},a=[{key:"start",value:function(){this.readFileCrc32(this.file)}},{key:"readFileCrc32",value:function(e){var t=this,r=this.sliceLength,i=e.slice||e.webkitSlice||e.mozSlice,n=new FileReader,o=0,s=0,a=0;!function c(){s<e.size&&(s=Math.min(o+r,e.size),104857600<e.size)&&e.size-s<=5242880&&(s=e.size),n.readAsArrayBuffer(i.call(e,o,s)),n.onload=function(r){r=r.target.result,a=eF.crc32(r,0),t.crc32Array.push({start:o,end:s,crc32:eF.dec2hex(a),buffer:r}),(o=s)<e.size?c():t.success(t.crc32Array)}}()}},{key:"success",value:function(e){this.successProcess(e)}},{key:"fail",value:function(e,t,r,i){3<=this.retryTime?this.failProcess():(this.readFileCrc32(e,t,r,i),this.retryTime++)}}],eN(s.prototype,a),c&&eN(s,c),Object.defineProperty(s,"prototype",{writable:!1}),s),eL="The format of stsToken is incorrect.";function eK(e){return(eK="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eq(){return(eq=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function eV(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function eW(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!=eK(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=eK(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"==eK(i)?i:i+""),n)}}var eJ=(u=function e(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e),this.context=t.context,this.key=t.key,this.isDirect=t.isDirect,this.isImageBatchUpload=t.isImageBatchUpload,this.file=t.file,this.type=(this.isImageBatchUpload?null==(t=this.file[0])?void 0:t.type:null==(t=this.file)?void 0:t.type)||"",this.sliceLength=eS.getFileSliceLength(this.file,r.getSliceFunc),this.config=r},l=[{key:"start",value:function(e,t,r){this.successProcess=t,this.failProcess=r,this._st=Date.now(),this.crc32(this.file,this.sliceLength)}},{key:"crc32",value:function(e,t){var r=this;if(this.isImageBatchUpload)for(var i=e.length,n=[],o=function(t){new eH(e[t],e[t].size,function(e){n[t]=e[0],n.filter(function(e){return!!e}).length===i&&r.success(n)},function(e){r.fail(e)}).start()},s=0;s<i;s++)o(s);else e&&e.size&&!(e.size<=0)?this.isDirect?new eH(e,e.size,function(e){r.success(e)},function(e){r.fail({errorCode:1000003,message:"get crc32 error: ".concat(e&&e.message)})}).start():this.sliceFile(e,t,function(e){r.success(e)},function(e){r.fail(e)}):this.fail({errorCode:1000003,message:"There is a problem with the input file or fileSize."})}},{key:"sliceFile",value:function(e,t,r,i){for(var n=[],o=e.size,s=e.slice||e.webkitSlice||e.mozSlice,a=0,c=0,u=0;c<o;)c=Math.min(a+t,o),n.push({start:a,end:c=104857600<o&&o-c<=5242880?o:c,crc32:0}),a=c;try{!function t(a){var c=new FileReader,l=n[a].start,f=n[a].end;c.readAsArrayBuffer(s.call(e,l,f)),c.onload=function(e){e=e.target.result,u=eF.dec2hex(eF.crc32(e,0)),n[a].crc32=u,f===o?r(n):t(n.length-1)},c.onerror=function(e){var t=e.target.error.name,e=e.target.error.message;i({crc32Array:n,errorCode:1000003,message:t+": "+e})}}(0)}catch(e){i({message:e&&e.toString()})}}},{key:"getCrc32Key",value:function(e,t){var r;return(t="[object Array]"===Object.prototype.toString.call(t)?function(e){if(Array.isArray(e))return eV(e)}(r=t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||function(e,t){var r;if(e)return"string"==typeof e?eV(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?eV(e,t):void 0}(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}():[t]).push(e[0].crc32,e[e.length-1].crc32),this.config.instanceId&&t.push(this.config.instanceId),t.join("_")}},{key:"success",value:function(e){var t=this.context,r=this.key,i=[],n=[];if(this.isImageBatchUpload)for(var o=0;o<this.file.length;o++)i.push(this.file[o].size),n.push(this.file[o].name);else i=this.file.size,n=this.file.name;var s=this.getCrc32Key(e,i),t=t.tasks[r];t&&this.successProcess(eq(t,{key:r,crc32Array:e,crc32Key:s,sdkVersion:"2.0.12",sliceLength:this.sliceLength,extra:{message:"get crc32 success"},stage:"crc32",type:"success",fileSize:i,fileName:n,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st,isDirect:this.isDirect,isImageBatchUpload:this.isImageBatchUpload}))}},{key:"fail",value:function(e){var t=this.context,r=this.key,i=e&&e.message?e.message:"get crc32 error",n=e&&e.errorCode,e=e&&e.crc32Array,t=eq(t.tasks[r],{crc32Array:e,extra:{message:i,errorCode:n},type:"error",stage:"crc32",stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st});this.failProcess(t)}}],eW(u.prototype,l),f&&eW(u,f),Object.defineProperty(u,"prototype",{writable:!1}),u),eX={checkFile:function(){},checkStsToken:function(e){return!e||e.SessionToken&&e.SecretAccessKey&&(e.AccessKeyId||e.AccessKeyID)},checkServiceName:function(e,t,r){if("vod"===r||r===ed)return r;if(e!==el){if(e===ef)return ed;if(e===ep){if(t.objectConfig&&t.objectConfig.spaceName)return"vod";if(t.objectConfig&&t.objectConfig.serviceId)return ed;if(t.videoConfig&&t.videoConfig.spaceName)return"vod";if(t.imageConfig&&t.imageConfig.serviceId)return ed}}return"vod"}};function eQ(e){return(eQ="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e$(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function eZ(){return(eZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function eY(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,e1(i.key),i)}}function e1(e){return e=function(e,t){if("object"!=eQ(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=eQ(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==eQ(e)?e:e+""}function e0(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(e0=function(){return!!e})()}function e2(e){return(e2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function e3(e,t){return(e3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var e4=function(){var e,t,r;function i(e,t){var r,n,o,s;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(n=this,o=e2(o=i),r=function(e,t){if(t&&("object"===eQ(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(n,e0()?Reflect.construct(o,s||[],e2(n).constructor):o.apply(n,s))).options=e,r.config=t,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.systemTimeGap=0,r.retryTime=t.retryTaskTime||2,r.hasRetryTime=0,r.isImageBatchUpload=!!r.options.isImageBatchUpload,r.isDirect=r.options.isDirect,r}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e3(e,t)}(i,p.a),e=i,t=[{key:"start",value:function(e,t,r){this.startOptions=e,this.failProcess=r,this.successProcess=t,this._st=Date.now(),r=(e=this.uploaderCtx._getCache(this.currFileCtx.crc32Key))?JSON.parse(e):{},!this.isDirect&&r.oid&&r.UploadID?this.resumeFromCache(r):this.startPreUpload()}},{key:"startPreUpload",value:function(){var e=this,t=this.config.region,r=new eT,i=(r.on("complete",function(t){if(t.response){var r=null;try{var i=JSON.parse(t.response);if(i.ResponseMetadata.Error)return e.fail({xhr:t,errorCode:i.ResponseMetadata.Error.CodeN,error:i.ResponseMetadata.Error.Code,message:i.ResponseMetadata.Error.Message});var n,o,s,a,c,u,l,f=eX.checkServiceName(e.options.type,e.config,e.options.serviceType),p=i.Result,h=f===ed?p.UploadAddress:p.InnerUploadAddress.UploadNodes[0],d=h.StoreInfos,g=h.UploadHosts,y=h.SessionKey,m=h.UploadHeader,v=f===ed?g[0]:h.UploadHost,b=null==(n=d[0])?void 0:n.UploadID,_=[],S=[];e.isImageBatchUpload&&1<d.length?d.forEach(function(e){_.push(e.Auth),S.push(e.StoreUri)}):(_=d[0].Auth,S=d[0].StoreUri),"vod"===f&&(o=p.InnerUploadAddress.UploadNodes).length&&1<o.length&&(a={SessionKey:(s=o[1]).SessionKey,UploadHeader:s.UploadHeader,StoreInfo:s.StoreInfos[0],UploadHost:s.UploadHost}),e.startOptions&&e.startOptions.enableSelectRoute&&(l=!0,e.startOptions.selectRouteResult)&&(u=!(((c=e.startOptions.selectRouteResult)[0]&&c[0].domainName)!==v)),r=eZ(e.currFileCtx,{key:e.options.key,useBackupDomain:e.uploaderCtx.useBackupDomain,signature:_,type:"success",extra:{message:"prepare upload success"},stage:"preUpload",oid:S,systemTimeGap:e.systemTimeGap,tosDomain:"".concat(e.config.schema,"://").concat(v),xhr:t,UploadHeader:void 0===m?{}:m,SessionKey:y,UploadID:b,fallbackStoreInfo:a,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration,useClientSelectRouteResult:u,enableSelectRoute:l})}catch(r){return e.fail({error:"catch error: ".concat(r.message||r.toString()),xhr:t})}return e.successProcess(r)}return e.fail({error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t})}),r.on("error",function(t){var r;(e.options.type===ef&&e.config.imageFallbackHost||e.options.type===el&&e.config.videoFallbackHost)&&!e.uploaderCtx.useBackupDomain?(e.hasRetryTime<e.retryTime-1?e.hasRetryTime++:e.uploaderCtx.useBackupDomain=!0,e.startPreUpload()):(r={error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t},t.response&&(t=JSON.parse(t.response)).ResponseMetadata&&t.ResponseMetadata.Error&&(r.errorCode=t.ResponseMetadata.Error.CodeN,r.error=t.ResponseMetadata.Error.Code,r.message=t.ResponseMetadata.Error.Message),e.fail(r))}),""),n={},o=this.uploaderCtx.useBackupDomain,s=eX.checkServiceName(this.options.type,this.config,this.options.serviceType),a=(s===ed&&(i=o?this.config.imageFallbackHost:this.config.imageHost,n={Action:"ApplyImageUpload",Version:"2018-08-01"},this.options.type===ef&&(this.config.imageConfig&&this.config.imageConfig.serviceId?n.ServiceId=this.config.imageConfig.serviceId:n.SpaceName=this.config.videoConfig&&this.config.videoConfig.spaceName),this.options.type===ep&&(n.ServiceId=this.config.objectConfig&&this.config.objectConfig.serviceId||this.config.imageConfig&&this.config.imageConfig.serviceId),this.currFileCtx.fileSize&&1<this.currFileCtx.fileSize.length&&(n.UploadNum=this.currFileCtx.fileSize.length),this.options.storeKey)&&(a=this.options.storeKey,"[object Array]"===Object.prototype.toString.call(a)?n.StoreKeys=a:"[object String]"===Object.prototype.toString.call(a)&&(n.StoreKeys=[a])),"vod"===s&&(a=this.config.videoConfig&&this.config.videoConfig.spaceName,this.options.type===ep&&this.config.objectConfig&&this.config.objectConfig.spaceName&&(a=this.config.objectConfig.spaceName),i=o?this.config.videoFallbackHost:this.config.videoHost,n={Action:"ApplyUploadInner",Version:"2020-11-19",SpaceName:a,FileType:this.options.type,IsInner:1},this.config.enOID&&(n.EnOID=1),(this.options.testHost||this.config.testHost)&&(n.TestHost=this.options.testHost||this.config.testHost),this.startOptions)&&this.startOptions.selectRouteResult&&(o=this.startOptions.selectRouteResult,n.ClientBestHosts=o.map(function(e){return e.domainName}).join(",")),this.currFileCtx.fileSize&&!this.currFileCtx.isImageBatchUpload&&(n.FileSize=this.currFileCtx.fileSize),this.config.useFileExtension&&this.currFileCtx.fileName&&(this.options.type===ep||this.options.type===ef)&&(a=this.currFileCtx.fileName,o=eS.getFileSuffix(a))&&(n.FileExtension=o),this.config.accountId&&(n["X-Account-Id"]=this.config.accountId),(this.options.type===ef||this.options.type===ep)&&this.config.bizType&&(n.BizType=this.config.bizType,n.AppID=this.config.appId,n.UserID=this.config.userId),this.config.openExperiment&&(n.app_id=this.config.appId,n.user_id=this.config.userId),n.s=Math.random().toString(36).substr(2),this.options.fileSize&&(n.FileSize=this.options.fileSize),this.currFileCtx.proxyStsToken||this.config.stsToken),o=eS.toQueryString(n),c=a.AccessKeyID,u=a.AccessKeyId,l=a.SecretAccessKey,f=a.SessionToken,a=a.CurrentTime,o={method:"GET",url:"".concat(i,"?").concat(o),timeout:this.config.gatewayTimeout||3e4,region:t,params:n,pathname:eS.getPathByURL(i)},t=new eC.a(o,s),n=(this.config.useServerCurrentTime&&6e4<Math.abs(new Date(a)-new Date)&&(this.systemTimeGap=new Date(a)-new Date),this.systemTimeGap?new Date((new Date).getTime()+this.systemTimeGap):new Date);t.addAuthorization({accessKeyId:u||c,secretAccessKey:l,sessionToken:f},n),r.send(o)}},{key:"resumeFromCache",value:function(e){var t=this,r=this.options.key,i=new eT,n=(i.on("complete",function(i){var n=null;try{var o=JSON.parse(i.response);if(!(2e3===o.code&&0<o.data.partlist.length))return t.startPreUpload();var s=t.confirmCache(o.data.partlist),a=e.hasMerge?5:s.isAllFinished?4:3,n=eZ(t.currFileCtx,e,{key:r,xhr:i,extra:{message:"prepare upload from cache success"},stage:"preUpload",type:"success",percent:0,cacheTask:a,proxyStsToken:t.options.stsToken,currentTask:1,status:1,isBreak:1,crc32Array:s.crc32Array,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st,totalDuration:Date.now()-t._st+t.currFileCtx.totalDuration})}catch(e){return t.startPreUpload()}t.successProcess(n)}),i.on("error",function(e){400<=e.status?t.startPreUpload():t.fail({error:"request error",xhr:e})}),this.config.userId);i.send({method:"get",url:eS.urlTemplate("{tosDomain}/upload/v1/{oid}?uploadid={uploadId}&action=part_list",{tosDomain:e.tosDomain,oid:e.oid,uploadId:e.UploadID}),headers:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e$(Object(r),!0).forEach(function(t){var i,n,o;i=e,n=t,o=r[t],(n=e1(n))in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e$(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({Authorization:e.signature,"X-Storage-U":encodeURIComponent(n)},e.UploadHeader),timeout:3e4})}},{key:"confirmCache",value:function(e){var t=this.currFileCtx.crc32Array,r={},i=(e.forEach(function(e){void 0===r[e.num-1]&&(r[e.num-1]={tag:!0,crc32:e.crc32})}),!0),e=t.map(function(e,t){return r[t]&&r[t].tag&&r[t].crc32?(e.crc32=r[t].crc32,e.finished=!0,e.loaded=e.end-e.start):i=!1,e});return{isAllFinished:i,crc32Array:e}}},{key:"fail",value:function(e){var t=this,r=e.xhr,i=e.errorCode||1001e3,n="prepare upload error: UNKNOWN",n=(r&&(n=0===r.status?"prepare upload error: NETERROR":e.message||"prepare upload error: ".concat(r.status)),eZ(this.currFileCtx,{extra:{message:n,error:e.error,errorCode:i},type:"error",stage:"preUpload",xhr:r,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration}));this.isImageBatchUpload&&(n.successImage=[],n.failImage=null==(e=this.currFileCtx)?void 0:e.crc32Array.map(function(e,r){return{crc32:e.crc32,fileSize:null==(e=t.currFileCtx)?void 0:e.fileSize[r],fileName:null==(e=t.currFileCtx)?void 0:e.fileName[r],finishSize:0,success:!1}})),this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(n)}}],eY(e.prototype,t),r&&eY(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}();function e5(e){return(e5="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e6(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function e8(){return(e8=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function e7(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,e9(i.key),i)}}function e9(e){return e=function(e,t){if("object"!=e5(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=e5(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==e5(e)?e:e+""}function te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(te=function(){return!!e})()}function tt(e){return(tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tr(e,t){return(tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var ti=function(){var e,t,r;function i(e,t){var r,n,o,s;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(n=this,o=tt(o=i),r=function(e,t){if(t&&("object"===e5(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(n,te()?Reflect.construct(o,s||[],tt(n).constructor):o.apply(n,s))).options=e,r.config=t,r.transport=new eT,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.eventInit(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tr(e,t)}(i,p.a),e=i,t=[{key:"initUpload",value:function(e){e&&(e=this.currFileCtx.fallbackStoreInfo)&&(e8(this.currFileCtx,{oid:e.StoreInfo.StoreUri,tosDomain:"".concat(this.config.schema,"://").concat(e.UploadHost),signature:e.StoreInfo.Auth,UploadHeader:e.UploadHeader,SessionKey:e.SessionKey}),this.uploaderCtx._saveTask(this.options.key));var e={oid:this.currFileCtx.oid,tosDomain:this.currFileCtx.tosDomain},e=eS.urlTemplate("{tosDomain}/upload/v1/{oid}?uploadmode=part&phase=init",e),t=this.config.userId;this.transport.send({method:"post",url:e,headers:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e6(Object(r),!0).forEach(function(t){var i,n,o;i=e,n=t,o=r[t],(n=e9(n))in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e6(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({Authorization:this.currFileCtx.signature,"X-Storage-U":encodeURIComponent(t)},this.currFileCtx.UploadHeader),timeout:this.config.initUploadTimeout||3e4})}},{key:"start",value:function(e,t,r){this.successProcess=t,this.failProcess=r,this._st=Date.now(),this.initUpload(e&&e.changeNodeRetry)}},{key:"eventInit",value:function(){var e=this;this.transport.on("complete",function(t){var r=null;try{var i,n=JSON.parse(t.response),o=null==(i=n.data)?void 0:i.uploadid;if(2e3!==n.code||!o)return e.fail({error:"fail! response.code: ".concat(n.code,", fail message: ").concat(n.message),code:null==n?void 0:n.code,message:null==n?void 0:n.message,xhr:t});r=e8(e.currFileCtx,{UploadID:o,percent:0,type:"success",extra:{message:"init upload id success"},stage:"initUploadID",xhr:t,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration})}catch(r){return e.fail({error:"catch error: ".concat(r.message||JSON.stringify(r)),xhr:t})}return e.successProcess(r)}),this.transport.on("error",function(t){e.fail({error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t})})}},{key:"fail",value:function(e){var t=this.options.context,r=this.options.key,t=e8(t.tasks[r],{extra:{message:"init upload id error, ".concat(e.error),errorCode:(null==e?void 0:e.code)||1002e3},type:"error",stage:"initUploadID",xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration});this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(t)}}],e7(e.prototype,t),r&&e7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}();function tn(e){return(tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function to(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function ts(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?to(Object(r),!0).forEach(function(t){var i,n,o;i=e,n=t,o=r[t],(n=tc(n))in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):to(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ta(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,tc(i.key),i)}}function tc(e){return e=function(e,t){if("object"!=tn(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=tn(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==tn(e)?e:e+""}function tu(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tu=function(){return!!e})()}function tl(e){return(tl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tf(e,t){return(tf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var tp=function(){var e,t,r;function i(e){var t,r,n,o,s=e.sliceItem,a=e.crc32,c=e.url,u=e.signature,l=e.uploadHeader,f=e.userId,p=e.retryTime,h=e.timeout,e=e.method,e=void 0===e?"POST":e;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(t=this,r=tl(r=i),o=function(e,t){if(t&&("object"===tn(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(t,tu()?Reflect.construct(r,n||[],tl(t).constructor):r.apply(t,n))).fileSlice=s,o.crc32=a,o.uploadUrl=c,o.uploadHeader=l,o.signature=u,o.userId=f,o.retryTime=p||0,o.method=e,o.retryCount=0,o.timeout=h||18e5,o.ready=!1,o.cancel=!1,o.transport=new eT,o.eventInit(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tf(e,t)}(i,p.a),e=i,t=[{key:"upload",value:function(e,t){this.isParamsValid()&&(this._st=Date.now(),this.transport&&this.transport.send({method:this.method,url:this.uploadUrl,headers:ts({Authorization:this.signature,"Content-CRC32":this.crc32,"X-Storage-U":encodeURIComponent(this.userId)},this.uploadHeader),file:this.fileSlice,binary:1,timeout:this.timeout}),e)&&this.emit("retry",t)}},{key:"isParamsValid",value:function(){return this.fileSlice&&(this.fileSlice.size||this.fileSlice.byteLength)?this.crc32?!!this.uploadUrl||(this.emit("error",{message:"slice upload failed: NOURL",crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength}),!1):(this.emit("error",{message:"slice upload failed: NOCRC32",crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength}),!1):(this.emit("error",{message:"slice upload failed: NOCONTENT",crc32:this.crc32}),!1)}},{key:"eventInit",value:function(){var e=this;this.transport.on("complete",function(t){try{var r=JSON.parse(t.response);2e3===r.code?e.success(t):e.fail(t,r)}catch(r){e.fail(t)}}),this.transport.on("error",function(t){e.fail(t)}),this.transport.on("progress",function(t){e.process(t)})}},{key:"success",value:function(e){this.ready=!0;var t=Date.now()-this._st,r=this.fileSlice.size||this.fileSlice.byteLength;this.emit("complete",{crc32:this.crc32,size:r,speed:r/t,xhr:e,sliceStartTime:this._st,sliceEndTime:Date.now(),sliceDuration:Date.now()-this._st})}},{key:"fail",value:function(e){var t,r,i=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.cancel||(t={crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength,xhr:e,sliceStartTime:this._st,sliceEndTime:Date.now(),sliceDuration:Date.now()-this._st},e&&401===e.status?this.emit("error",ts({message:"slice upload failed: UNAUTHORIZED"},t)):(r="slice upload failed: UNKNOWN",e&&(r=e.status?"slice upload failed: ".concat((null==n?void 0:n.message)||e.status):"slice upload failed: NETERROR"),this.retryCount<this.retryTime?(setTimeout(function(){i.upload(!0,ts({message:r},t))},1e3),this.retryCount++):this.emit("error",ts({message:r,code:null==n?void 0:n.code},t))))}},{key:"process",value:function(e){this.cancel||this.emit("progress",{crc32:this.crc32,loaded:e.loaded||0,total:e.total||0})}},{key:"abort",value:function(){this.transport&&(this.cancel=!0,this.transport.abort())}},{key:"destroy",value:function(){this.transport=null}}],ta(e.prototype,t),r&&ta(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(),ei=r(2),th=r.n(ei);function td(e){return(td="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tg(){return(tg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function ty(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function tm(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!=td(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=td(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"==td(i)?i:i+""),n)}}function tv(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tv=function(){return!!e})()}function tb(e){return(tb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function t_(e,t){return(t_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var tS=function(){var e,t,r;function i(e){var t,r,n,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(t=this,r=tb(r=i),o=function(e,t){if(t&&("object"===td(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(t,tv()?Reflect.construct(r,n||[],tb(t).constructor):r.apply(t,n))).file=e.file,o.context=e.context,o.key=e.key,o.config=s,o.finishArr=[],o.errorLength=0,o.finishSize=0,o.retryUploadTime=Number(s.retryUploadTime)||2,o.progressMonitorTime=Number(s.progressMonitorTime)||10,o.progressMonitorSpeed=Number(s.progressMonitorSpeed)||50,o.uploadSliceCount=Number(s.uploadSliceCount)||3,o.realtimeSpeedInterval=Number(s.realtimeSpeedInterval)||5,o.processRetry=0,o.lastFinishSize=-1,o.lastProcessPercent=-1,o.lastIntervalSize=-1,o.lastCalculateSpeedTime=-1,o.lastCalculateSpeedSize=0,o.uploadHandlers={},o}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&t_(e,t)}(i,p.a),e=i,t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this.errorLength=0,this.currentCtx=this.context.tasks[this.key],this.crc32Array=this.context.tasks[this.key].crc32Array,this.uploadSliceCount=this.uploadSliceCount>this.crc32Array.length?this.crc32Array.length:this.uploadSliceCount,this.lastIndex=0,this.uploading=[],this._uploadSize=this.crc32Array.reduce(function(e,t){return e+(t.finished?0:t.end-t.start)},0),this._st=Date.now(),this._lastSaveTime=Date.now(),this.lastCalculateSpeedTime=this._st,this.initWorker(),this.setProgressMonitor(),this.threadUpload()}},{key:"initWorker",value:function(){var e,t=this;this.worker||(e=this.crc32Array,this.worker=new th.a,this.worker.onmessage=function(r){var i,n,r=(i=r.data,n=4,function(e){if(Array.isArray(e))return e}(i)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,o,s,a=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(i=o.call(r)).done)&&(a.push(i.value),a.length!==t);c=!0);}catch(e){u=!0,n=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw n}}return a}}(i,n)||function(e,t){var r;if(e)return"string"==typeof e?ty(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ty(e,t):void 0}(i,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],s=r[1],a=r[2],r=r[3],c=(new Date).getTime(),u=e[a];u.crc32=s,u.crc32StartTime=r,u.crc32EndTime=c,u.crc32Duration=c-r,t.upload(u,o,a)})}},{key:"read",value:function(e,t){var r=this,i=this.file,n=i.slice||i.webkitSlice||i.mozSlice,o=new FileReader;o.onload=function(e){var i=(new Date).getTime();r.worker.postMessage([e.target.result,t,i,!!r.config.clientEncrypt,r.currentCtx.clientEncryptKey,r.crc32Array.length-1===t],[e.target.result])},o.onerror=function(){r.stop(),r.fail({extra:{message:"An error occurred reading the file",errorCode:1003003}})},o.readAsArrayBuffer(n.call(i,e.start,e.end))}},{key:"threadUpload",value:function(){if(this.uploading.length<this.uploadSliceCount){var e=this.lastIndex,t=this.crc32Array[e];if(t){if(t.finished){if(-1===this.finishArr.indexOf(t.start)&&(this.finishArr.push(t.start),this.finishArr.length>=this.crc32Array.length))return this.stop(),void this.success()}else t.loaded=0,this.uploading.push(e),this.read(t,e);this.lastIndex++,this.threadUpload()}}}},{key:"stop",value:function(){var e=this;Object.keys(this.uploadHandlers).forEach(function(t){e.uploadHandlers[t].abort(),e.uploadHandlers[t].destroy()}),this.uploadHandlers={},this.worker&&this.worker.terminate(),this.worker=null,this.clearMonitor()}},{key:"setProgressMonitor",value:function(){var e=this;this.progressMonitorInterval=setInterval(function(){var t,r=e.finishSize;r-e.lastIntervalSize<e.progressMonitorTime*e.progressMonitorSpeed*1024?(t=tg(e.currentCtx,{stage:"process",type:"warn",extra:{message:"percent are not updated in ".concat(e.progressMonitorTime," seconds")}}),e.context.logger.send(t),e.context._broadcast("slowProgress",t),e.clearMonitor()):e.lastIntervalSize=r},1e3*this.progressMonitorTime)}},{key:"clearMonitor",value:function(){this.progressMonitorInterval&&clearInterval(this.progressMonitorInterval)}},{key:"upload",value:function(e,t,r){var i=this,n=e.crc32,o={part_number:r+1,uploadId:this.currentCtx.UploadID,oid:this.currentCtx.oid,tosDomain:this.currentCtx.tosDomain},o=eS.urlTemplate(h,o),s=this.config.userId,a=this.config.uploadTimeout,t=(this.config.clientEncrypt||(t=eS.fileSlice(this.file,e.start,e.end)),new tp({sliceItem:t,crc32:n,url:o,signature:this.currentCtx.signature,uploadHeader:this.currentCtx.UploadHeader,userId:s,method:"POST",retryTime:this.retryUploadTime,timeout:a}));t.on("complete",function(t){1===i.currentCtx.status&&(t.start=e.start,t.crc32StartTime=e.crc32StartTime,t.crc32EndTime=e.crc32EndTime,t.crc32Duration=e.crc32Duration,t.index=r,i.fileSliceSuccess(t))}),t.on("error",function(t){1===i.currentCtx.status&&(t.start=e.start,t.crc32StartTime=e.crc32StartTime,t.crc32EndTime=e.crc32EndTime,t.crc32Duration=e.crc32Duration,t.index=r,i.fail(t))}),t.on("progress",function(t){1===i.currentCtx.status&&(t.start=e.start,t.index=r,i.process(t))}),t.on("retry",function(t){1===i.currentCtx.status&&(t.start=e.start,t.index=r,i.retry(t))}),t.upload(),this.uploadHandlers[r]=t}},{key:"success",value:function(e){this.finishArr=[];var t=Date.now()-this._st,t=this._uploadSize/t,t=tg(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"upload all success"},speed:t,xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._lastSaveTime+this.currentCtx.totalDuration,isAllFinish:!0});this.worker&&this.worker.terminate(),this.successProcess(t)}},{key:"fail",value:function(e){var t=this.errorFormat(e);t.type="error",void 0!==e.statusCode&&tg(this.currentCtx,{statusCode:e.statusCode}),this.errorLength||(this.context.logger.send(tg({},t)),this.stop(),this.context._broadcast("error",t),null!=(e=this.currentCtx)&&e.isBreak?this.context._cancel(this.key):this.context._pause(this.key),this.errorLength++)}},{key:"retry",value:function(e){e=this.errorFormat(e),this.context.logger.send(tg({},e,{type:"retry"}))}},{key:"fileSliceSuccess",value:function(e){var t,r=e.index,i=Date.now(),n=(-1===this.finishArr.indexOf(e.start)&&this.finishArr.push(e.start),this.crc32Array[r].finished=!0,this.crc32Array[r].speed=e.speed,{message:"slice upload success"});e.xhr&&(t=e.xhr,n.currentUrl=t.currentUrl||"",tg(this.currentCtx,{req:{url:t.currentUrl,param:t.params},res:{status:t.status,body:t.responseText,header:t.getAllResponseHeaders()}}),delete e.xhr),this.context.logger.send(tg(this.currentCtx,{stage:"process",type:"success",sliceIndex:r,extra:n,totalDuration:i-this._lastSaveTime+this.currentCtx.totalDuration,sliceStartTime:e.sliceStartTime,sliceEndTime:e.sliceEndTime,sliceDuration:e.sliceDuration,crc32StartTime:e.crc32StartTime,crc32EndTime:e.crc32EndTime,crc32Duration:e.crc32Duration})),this._lastSaveTime=i,this.uploading.splice(this.uploading.indexOf(r),1),this.uploadHandlers[r]&&delete this.uploadHandlers[r],this.finishArr.length>=this.crc32Array.length?(this.stop(),this.success(e.xhr)):this.threadUpload()}},{key:"getFinishSize",value:function(e,t){var r=t.crc32,i=0;return e.forEach(function(e){e.crc32===r?(e.loaded=t.loaded,i+=t.loaded):(e.loaded||(e.loaded=0),i+=e.loaded)}),i}},{key:"process",value:function(e){var t=this.currentCtx.realtimeSpeed||0,r=this.currentCtx.fileSize,i=(this.finishSize=this.getFinishSize(this.crc32Array,e),this.finishSize>this.lastFinishSize&&((e=new Date).getTime()-this.lastCalculateSpeedTime>1e3*this.realtimeSpeedInterval&&(n=e.getTime()-this.lastCalculateSpeedTime,t=Math.floor((i=this.finishSize-this.lastCalculateSpeedSize)/n),this.lastCalculateSpeedTime=e.getTime(),this.lastCalculateSpeedSize=this.finishSize),this.lastFinishSize=this.finishSize),Math.floor(this.finishSize/r*1e4)/100||0),n=tg(this.currentCtx,{stage:"process",percent:i,realtimeSpeed:t});i>this.lastProcessPercent&&100!==i&&(this.lastProcessPercent=i,this.context._broadcast("progress",n))}},{key:"errorFormat",value:function(e){var t=this.currentCtx.totalDuration,r=Date.now()-this._st,i=e.index,n=e.crc32?{message:e.message,data:e.crc32,size:e.size}:e.extra,n=(n.errorCode=(null==e?void 0:e.code)||n.errorCode||1003e3,tg(this.currentCtx,{extra:n,sliceIndex:i,stage:"process",req:{},res:{},totalDuration:r+t,sliceStartTime:e.sliceStartTime,sliceEndTime:e.sliceEndTime,sliceDuration:e.sliceDuration,crc32StartTime:e.crc32StartTime,crc32EndTime:e.crc32EndTime,crc32Duration:e.crc32Duration}));return e.xhr&&(i=e.xhr,n.req={url:e.xhr.currentUrl},n.res={status:i.status,body:i.responseText,header:i.getAllResponseHeaders()},delete e.xhr),n}}],tm(e.prototype,t),r&&tm(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}();function tw(e){return(tw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tk(){return(tk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tx(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function tO(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,tE(i.key),i)}}function tE(e){return e=function(e,t){if("object"!=tw(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=tw(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==tw(e)?e:e+""}function tT(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tT=function(){return!!e})()}function tC(e){return(tC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tD(e,t){return(tD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var tz=function(){var e,t,r;function i(e,t){var r,n,o,s;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(n=this,o=tC(o=i),r=function(e,t){if(t&&("object"===tw(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(n,tT()?Reflect.construct(o,s||[],tC(n).constructor):o.apply(n,s))).options=e,r.config=t,r.transport=new eT,r.eventInit(),r.errorCount=0,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tD(e,t)}(i,p.a),e=i,t=[{key:"mergeFile",value:function(){for(var e={oid:this.currFileCtx.oid,uploadId:this.currFileCtx.UploadID,tosDomain:this.currFileCtx.tosDomain},t=this.currFileCtx.crc32Array,r="",i=0;i<t.length;i++)r=(r?"".concat(r,","):"").concat(i+1,":").concat(t[i].crc32);var e=eS.urlTemplate("{tosDomain}/upload/v1/{oid}?uploadmode=part&phase=finish&uploadid={uploadId}",e),n=this.config.userId,n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tx(Object(r),!0).forEach(function(t){var i,n,o;i=e,n=t,o=r[t],(n=tE(n))in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tx(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({Authorization:this.currFileCtx.signature,"X-Storage-U":encodeURIComponent(n)},this.currFileCtx.UploadHeader);this.config.clientEncrypt&&(n["x-upload-encryption-mode"]=2,n["x-upload-encryption-key"]=btoa(this.currFileCtx.clientEncryptKey)),this.transport.send({method:"post",url:e,headers:n,custom:r})}},{key:"start",value:function(e,t,r){this.successProcess=t,this.failProcess=r,this._st=Date.now(),this.mergeFile()}},{key:"eventInit",value:function(){var e=this,t=this.options.stage;this.transport.on("complete",function(r){var i=null;try{var n,o=JSON.parse(r.response);if(2e3!==o.code||null==(n=o.data)||!n.key)return e.fail({error:"fail! response.code: ".concat(o.code,", fail message: ").concat(o.message),code:null==o?void 0:o.code,message:null==o?void 0:o.message,xhr:r});i=tk(e.currFileCtx,{stage:t,type:"success",hasMerge:!0,extra:{message:"merge file success"},xhr:r,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration})}catch(t){return e.fail({error:"response parse error: ".concat(t.message||JSON.stringify(t)),xhr:r})}return e.successProcess(i)}),this.transport.on("error",function(t){e.fail({error:"request fail: ".concat(t.statusText||t.errText),xhr:t})})}},{key:"getProcessIndex",value:function(e){var t=0;return e.forEach(function(e,r){"process"===e.stage&&(t=r)}),t}},{key:"fail",value:function(e){e=tk(this.currFileCtx,{extra:{message:"merge file error, ".concat(e.error),errorCode:(null==e?void 0:e.code)||1004e3},type:"error",stage:this.options.stage,xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration}),this.failProcess(e)}}],tO(e.prototype,t),r&&tO(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}();function tj(e){return(tj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tI(){return(tI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tA(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!=tj(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=tj(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"==tj(i)?i:i+""),n)}}function tP(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tP=function(){return!!e})()}function tB(e){return(tB=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tR(e,t){return(tR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var tU=function(){var e,t,r;function i(e){var t,r,n,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(t=this,r=tB(r=i),o=function(e,t){if(t&&("object"===tj(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(t,tP()?Reflect.construct(r,n||[],tB(t).constructor):r.apply(t,n))).options=e,o.file=e.file,o.context=e.context,o.key=e.key,o.isImageBatchUpload=e.isImageBatchUpload,o.config=s,o.finishArr=[],o.errorLength=0,o.finishSize=0,o.retryUploadTime=o.config.retryUploadTime||0,o.processRetry=0,o.lastFinishSize=-1,o.lastProcessPercent=-1,o.lastIntervalSize=-1,o.uploader={},o._uploadProcessMap={},o}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tR(e,t)}(i,p.a),e=i,t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this.currentCtx=this.context.tasks[this.key],this.crc32Array=this.context.tasks[this.key].crc32Array,this._uploadSize=this.isImageBatchUpload?this.currentCtx.fileSize.reduce(function(e,t){return e+t}):this.file.size,this._st=Date.now(),this.upload()}},{key:"stop",value:function(){var e=this;this.uploader&&Object.keys(this.uploader).forEach(function(t){e.uploader[t]&&(e.uploader[t].abort(),e.uploader[t].destroy())})}},{key:"upload",value:function(){for(var e=this,t=this.crc32Array.length,r=0,i=0,n=0;n<t;n++){var o=this.crc32Array[n],s=o.buffer,o=o.crc32,a=this.currentCtx.signature,a="[object Array]"===Object.prototype.toString.call(a)?a[n]:a,c=this.currentCtx.oid,c="[object Array]"===Object.prototype.toString.call(c)?c[n]:c,u={oid:c,tosDomain:this.currentCtx.tosDomain},u=eS.urlTemplate(d,u),l=this.config.userId,f=this.config.uploadTimeout,p=void 0,h=this.isImageBatchUpload?(p=this.currentCtx.fileSize[n],this.currentCtx.fileName[n]):(p=this.file.size,this.file.name);this._uploadProcessMap[o]&&this._uploadProcessMap[o].success?r+=1:(this._uploadProcessMap[o]={crc32:o,fileSize:p,fileName:h,oid:c,finishSize:0,success:!1},(p=new tp({sliceItem:s,crc32:o,url:u,signature:a,uploadHeader:this.currentCtx.UploadHeader,userId:l,retryTime:this.retryUploadTime,method:"POST",timeout:f})).on("complete",function(n){r++,e._uploadProcessMap[n.crc32].finishSize=n.size,e._uploadProcessMap[n.crc32].success=!0,i+r===t&&e.success(n.xhr)}),p.on("error",function(r){++i===t&&e.fail(r)}),p.on("progress",function(t){e.process(t)}),p.upload(),this.uploader[o]=p)}}},{key:"success",value:function(e){this.finishArr=[];var t=Date.now()-this._st,t=this._uploadSize/t,r=tI(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"direct upload success"},speed:t,xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration});this.isImageBatchUpload&&(r.successImage=[],r.failImage=[],Object.values(this._uploadProcessMap).forEach(function(e){(e.success?r.successImage:r.failImage).push(e)})),this.uploader=null,this._uploadProcessMap=null,this.successProcess(r)}},{key:"fail",value:function(e){e=tI(this.currentCtx,{extra:{message:"direct upload error: ".concat(e.message||e.xhr.errText),errorCode:e.code||1003e3},type:"error",stage:"process",xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration}),this.isImageBatchUpload&&(e.failImage=Object.values(this._uploadProcessMap)),this.uploader=null,this._uploadProcessMap=null,this.failProcess(e)}},{key:"process",value:function(e){var t=this._uploadSize,e=(this._uploadProcessMap[e.crc32].finishSize=Math.max(this._uploadProcessMap[e.crc32].finishSize,e.loaded),this.finishSize=Object.values(this._uploadProcessMap).reduce(function(e,t){return e+t.finishSize},0),this.finishSize>this.lastFinishSize&&(this.lastFinishSize=this.finishSize),Math.floor(this.finishSize/t*1e4)/100||0),t=tI(this.currentCtx,{stage:"process",percent:e});e>this.lastProcessPercent&&100!==e&&(this.lastProcessPercent=e,this.context._broadcast("progress",t))}}],tA(e.prototype,t),r&&tA(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}();function tM(e){return(tM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tF(){return(tF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tG(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!=tM(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=tM(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"==tM(i)?i:i+""),n)}}function tN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tN=function(){return!!e})()}function tH(e){return(tH=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tL(e,t){return(tL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var tK=function(){var e,t,r;function i(e){var t,r,n,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(t=this,r=tH(r=i),o=function(e,t){if(t&&("object"===tM(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(t,tN()?Reflect.construct(r,n||[],tH(t).constructor):r.apply(t,n))).options=e,o.file=e.file,o.context=e.context,o.key=e.key,o.config=s,o.errorLength=0,o.retryUploadTime=Number(s.retryUploadTime)||2,o.maxUploadSliceCount=Number(s.uploadSliceCount)||5,o.uploadQueue=[],o.crc32Array=[],o.uploadSliceCount=0,o.isCalcCrc32=!1,o.isFileReading=!1,o.hasStarted=!1,o.hasCompleteUpload=!1,o}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tL(e,t)}(i,p.a),e=i,t=[{key:"start",value:function(e,t,r){this.failProcess=r,this.successProcess=t,this.currentCtx=this.context.tasks[this.key],this.hasStarted=!0,this._st=Date.now(),this.initWorker()}},{key:"initWorker",value:function(){var e=this;this.worker||(this.worker=new th.a,this.worker.onmessage=function(t){e.isCalcCrc32=!1;var r=t.data[0],i=t.data[2],n=t.data[1];e.uploadQueue.forEach(function(t,o){t.index===i&&(e.uploadQueue[o].crc32=n,e.uploadQueue[o].fileSliceBuffer=r,e.crc32Array[i]={crc32:n})}),e.startUploadQueue()},this.startUploadQueue())}},{key:"addStreamSlice",value:function(e){var t=this,r=e.fileSlice,i=e.index,e=(this.isFileReading=!0,new FileReader);e.readAsArrayBuffer(r),e.onload=function(e){t.isFileReading=!1,e=e.target.result,t.uploadQueue.push({fileSliceBuffer:e,index:i}),t.hasStarted&&t.startUploadQueue()}}},{key:"completeStreamUpload",value:function(){this.hasCompleteUpload=!0,0!==this.uploadQueue.length||this.isFileReading||this.success()}},{key:"startUploadQueue",value:function(){var e;this.uploadSliceCount<=this.maxUploadSliceCount&&0<this.uploadQueue.length&&this.uploadQueue[0].crc32?(e=this.uploadQueue.shift(),this.uploadSliceCount++,this.upload({sliceItem:e.fileSliceBuffer,index:e.index,crc32:e.crc32})):0<this.uploadQueue.length&&!this.uploadQueue[0].crc32&&this.startCrc32Queue()}},{key:"startCrc32Queue",value:function(){if(!this.isCalcCrc32)for(var e=0;e<this.uploadQueue.length;e++){var t=this.uploadQueue[e];if(!t.crc32){this.isCalcCrc32=!0,this.worker.postMessage([t.fileSliceBuffer,t.index],[t.fileSliceBuffer]);break}}}},{key:"upload",value:function(e){var t=this,r=e.sliceItem,i=e.index,e=e.crc32,n=this.currentCtx.signature,o={part_number:i+1,uploadId:this.currentCtx.UploadID,oid:this.currentCtx.oid,tosDomain:this.currentCtx.tosDomain},o=eS.urlTemplate(h,o),s=this.config.userId,r=new tp({sliceItem:r,crc32:e,url:o,signature:n,uploadHeader:this.currentCtx.UploadHeader,userId:s,retryTime:this.retryUploadTime,method:"POST",timeout:this.config.uploadTimeout});r.on("complete",function(e){1===t.currentCtx.status&&(e.index=i,t.fileSliceSuccess(e))}),r.on("error",function(e){1===t.currentCtx.status&&(e.index=i,t.fail(e))}),r.upload()}},{key:"fileSliceSuccess",value:function(e){var t=e.index,r=Date.now(),i={message:"stream slice upload success"},n=(e.xhr&&(n=e.xhr,i.currentUrl=n.currentUrl||"",tF(this.currentCtx,{req:{url:n.currentUrl,param:n.params},res:{status:n.status,body:n.responseText,header:n.getAllResponseHeaders()}}),delete e.xhr),this.context.logger.send(tF(this.currentCtx,{stage:"process",type:"success",sliceIndex:t,extra:i,totalDuration:r-this._lastSaveTime+this.currentCtx.totalDuration})),tF(this.currentCtx,{uploadQueueLength:this.uploadQueue.length,sliceIndex:t}));this.context._broadcast("stream-progress",n),this.uploadSliceCount--,this.hasCompleteUpload&&0===this.uploadQueue.length?this.success(e.xhr):this.startUploadQueue()}},{key:"success",value:function(e){this.isAllSuccess||(e=tF(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"all slice upload success"},crc32Array:this.crc32Array,xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration}),this.successProcess(e))}},{key:"fail",value:function(e){var t=e.index,e=tF(this.currentCtx,{extra:{message:"stream slice upload error"},type:"error",stage:"process",xhr:e.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currentCtx.totalDuration,sliceIndex:t});this.context.logger.send(tF({},e)),this.context._broadcast("error",e)}}],tG(e.prototype,t),r&&tG(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}();function tq(e){return(tq="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tV(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function tW(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tV(Object(r),!0).forEach(function(t){var i,n,o;i=e,n=t,o=r[t],(n=tQ(n))in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tV(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function tJ(){return(tJ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function tX(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,tQ(i.key),i)}}function tQ(e){return e=function(e,t){if("object"!=tq(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=tq(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==tq(e)?e:e+""}function t$(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t$=function(){return!!e})()}function tZ(e){return(tZ=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tY(e,t){return(tY=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var t1=function(){var e,t,r;function i(e,t){var r,n,o,s;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(n=this,o=tZ(o=i),r=function(e,t){if(t&&("object"===tq(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(n,t$()?Reflect.construct(o,s||[],tZ(n).constructor):o.apply(n,s))).options=e,r.config=t,r.uploaderCtx=e.context,r.currFileCtx=e.context.tasks[e.key],r.isImageBatchUpload=!!r.options.isImageBatchUpload,r.skipCommit=e.skipCommit,r.transport=new eT,r.eventInit(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tY(e,t)}(i,p.a),e=i,t=[{key:"commitUpload",value:function(){var e,t,r=this.options.key,r=this.options.context.tasks[r],i=this.config.region,n="",o={},s=this.uploaderCtx.useBackupDomain,a=eX.checkServiceName(this.options.type,this.config,this.options.serviceType),c=(a===ed&&(n=s?this.config.imageFallbackHost:this.config.imageHost,o={Action:"CommitImageUpload",Version:"2018-08-01"},t={SessionKey:r.SessionKey},this.options.type===ef&&(this.config.imageConfig&&this.config.imageConfig.serviceId?o.ServiceId=this.config.imageConfig.serviceId:o.SpaceName=this.config.videoConfig&&this.config.videoConfig.spaceName,Array.isArray(e=this.config.imageConfig&&this.config.imageConfig.processAction)&&0<e.length&&(t.Functions=e),this.config.skipMeta)&&(o.SkipMeta=!0),this.options.type===ep&&(o.ServiceId=this.config.objectConfig&&this.config.objectConfig.serviceId||this.config.imageConfig&&this.config.imageConfig.serviceId),e=JSON.stringify(t)),"vod"===a&&(c=this.config.videoConfig&&this.config.videoConfig.spaceName,this.options.type===ep&&this.config.objectConfig&&this.config.objectConfig.spaceName&&(c=this.config.objectConfig.spaceName),n=s?this.config.videoFallbackHost:this.config.videoHost,o={Action:"CommitUploadInner",Version:"2020-11-19",SpaceName:c},t={SessionKey:r.SessionKey,Functions:[]},s=this.config.videoConfig&&this.config.videoConfig.processAction,this.options.type===ep&&this.config.objectConfig&&this.config.objectConfig.processAction&&(s=this.config.objectConfig.processAction),Array.isArray(s)&&0<s.length&&(t.Functions=s),(this.config.videoConfig&&this.config.videoConfig.callbackArgs||this.options.callbackArgs)&&(t.CallbackArgs=this.options.callbackArgs||this.config.videoConfig.callbackArgs),this.options.type===el&&this.config.skipDownload&&(o.SkipDownload=!0),this.options.type===ep&&this.options.objectSync&&(t.ObjectSync=this.options.objectSync),this.options.type===el&&this.options.needExactFormat&&(t.needExactFormat=this.options.needExactFormat),e=JSON.stringify(t)),this.config.accountId&&(o["X-Account-Id"]=this.config.accountId),this.config.openExperiment&&(o.app_id=this.config.appId,o.user_id=this.config.userId),eS.toQueryString(o)),s=this.currFileCtx.proxyStsToken||this.config.stsToken,u=s.AccessKeyID,l=s.AccessKeyId,f=s.SecretAccessKey,s=s.SessionToken,c={method:"POST",url:"".concat(n,"?").concat(c),timeout:this.config.gatewayTimeout||3e4,region:i,params:o,headers:{},pathname:eS.getPathByURL(n)},i=(c.custom=e,c.body=t,a===ed&&(c.headers["Content-Type"]="application/json"),new eC.a(c,a)),o=r.systemTimeGap,n=o?new Date((new Date).getTime()+o):new Date;i.addAuthorization({accessKeyId:l||u,secretAccessKey:f,sessionToken:s},n),this.transport.send(c)}},{key:"start",value:function(e,t,r){if(this.successProcess=t,this.failProcess=r,this._st=Date.now(),this.skipCommit)return this.successProcess(tJ(this.currFileCtx,{stage:"complete",type:"success",percent:100,extra:{message:"upload successful, skip commit"},stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration,skipCommit:this.skipCommit}));try{this.commitUpload()}catch(e){this.fail({error:"catch error: ".concat(e.toString())})}}},{key:"eventInit",value:function(){var e=this;this.transport.on("complete",function(t){var r=null;try{var i=JSON.parse(t.response);if(i.ResponseMetadata.Error)return e.fail({xhr:t,errorCode:i.ResponseMetadata.Error.CodeN,error:i.ResponseMetadata.Error.Code,message:i.ResponseMetadata.Error.Message});var n,o,s=eX.checkServiceName(e.options.type,e.config,e.options.serviceType),a=i.Result,c={};s===ed?e.isImageBatchUpload?(n=a.Results,o=a.PluginResult||[],n.forEach(function(e,t){n[t]=tW(tW({},n[t]),o[t])}),c=n):tJ(c=a.Results[0],a.PluginResult&&a.PluginResult[0]):c=a.Results[0],r=tJ(e.currFileCtx,{stage:"complete",type:"success",percent:100,extra:{message:"upload successful"},uploadResult:c,xhr:t,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st,totalDuration:Date.now()-e._st+e.currFileCtx.totalDuration,skipCommit:e.skipCommit})}catch(r){return e.fail({error:"catch error: ".concat(r.message||r.toString()),xhr:t})}return e.successProcess(r)}),this.transport.on("error",function(t){var r={error:"request fail: ".concat(t.statusText||t.errText||"UNKNOWN"),xhr:t};t.response&&(t=JSON.parse(t.response)).ResponseMetadata&&t.ResponseMetadata.Error&&(r.errorCode=t.ResponseMetadata.Error.CodeN,r.error=t.ResponseMetadata.Error.Code,r.message=t.ResponseMetadata.Error.Message),e.fail(r)})}},{key:"fail",value:function(e){var t=this.options.context,r=this.options.key,i=e.xhr,n=e.errorCode||1005e3,o="commit upload error: UNKNOWN",t=(i&&(o=0===i.status?"commit upload error: NETERROR":e.message||"commit upload error: ".concat(i.status)),tJ(t.tasks[r],{extra:{message:o,error:e.error,errorCode:n},type:"error",stage:"complete",xhr:i,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,totalDuration:Date.now()-this._st+this.currFileCtx.totalDuration,skipCommit:this.skipCommit}));this.failProcess(t)}}],tX(e.prototype,t),r&&tX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}();function t0(e){return(t0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function t2(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function t3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?t2(Object(r),!0).forEach(function(t){var i,n,o;i=e,n=t,o=r[t],(n=t6(n))in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t2(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function t4(){return(t4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function t5(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,t6(i.key),i)}}function t6(e){return e=function(e,t){if("object"!=t0(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=t0(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==t0(e)?e:e+""}function t8(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t8=function(){return!!e})()}function t7(e){return(t7=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function t9(e,t){return(t9=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var re=function(){var e,t,r;function i(e){var t,r,n,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=2<arguments.length?arguments[2]:void 0,c=3<arguments.length?arguments[3]:void 0;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(t=this,r=i,n=[e],r=t7(r),o=function(e,t){if(t&&("object"===t0(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(t,t8()?Reflect.construct(r,n||[],t7(t).constructor):r.apply(t,n))).tasks=e,o.config=s,o.key=c,o.uploaderCtx=a,o.current=0,o.length=o.tasks.length,o.taskError={},o.uploadList=[],o.retryTaskTime=s.retryTaskTime||2,o}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&t9(e,t)}(i,p.a),e=i,t=[{key:"start",value:function(e){var t=this.tasks.shift();t&&(this.current=t.index,this.execTask(t,e))}},{key:"execTask",value:function(e,t){var r,i,n=this,o=e.key,s=this.uploaderCtx,a=s.tasks[o];a&&(r=a.cacheTask,i=s.taskList[o].length,r&&0<e.index&&e.index<r?this.start():(a.currentTask=e.index,1===a.status&&(1!==e.index&&"initUploadID"!==e.stage||(e.arg=t4(e.arg,t)),e)&&e.func.call(e.context,e.arg,function(r){var c;s.taskList[o]&&((c=s.taskList[o][e.index+1])&&0!==e.index&&!a.isDirect?s._saveTask(o,{currentTask:c.index,stage:c.stage}):e.index===i-1&&s._removeTaskCache(o),n.success(r),0<n.tasks.length?n.start(t):s._queueSuccess(o))},function(r){var i;r.xhr&&400<=r.xhr.status||3===e.index&&r.isDirect?n.fail(r):!n.taskError[o]||n.taskError[o]<n.retryTaskTime?(n.taskError[o]?n.taskError[o]++:n.taskError[o]=1,i=n.errorFormat(r,!0),n.uploaderCtx.logger.send(i),"initUploadID"===e.stage?n.execTask(e,t3(t3({},t),{},{changeNodeRetry:!0})):n.execTask(e,t)):(r.key=o,n.fail(r))})))}},{key:"addTask",value:function(e){this.tasks.push(e)}},{key:"success",value:function(e){var t;e.xhr&&(t=e.xhr,e.req={url:t.currentUrl,param:t.params},e.res={status:t.status,header:t.getAllResponseHeaders(),body:t.responseText},delete e.xhr),t4(e,{type:"success"});try{this.uploaderCtx._broadcast(e.stage,e)}catch(e){throw Error(e)}this.uploaderCtx.logger.send(e)}},{key:"fail",value:function(e){var t,r=this.uploaderCtx,i=e.key,e=this.errorFormat(e);try{r._broadcast("error",e)}catch(e){throw Error(e)}null!=(t=r.tasks[i])&&t.isBreak?r._cancel(i):r._pause(i),r.logger.send(e)}},{key:"cancel",value:function(e){var t,r=this.key,i=this.uploaderCtx.tasks[r].currentTask;this.uploaderCtx.taskList[r].forEach(function(e){i===e.index&&(t=e)}),e?3===i&&this.uploaderCtx.tasks[r].isDirect&&t&&null!=(e=t)&&null!=(e=e.context)&&e.stop():(this.tasks=[],t&&3===t.index&&t.context.stop(),this.uploaderCtx._removeTaskCache(r))}},{key:"restart",value:function(){this.uploadList.forEach(function(e){e.cancel=!1}),this.start()}},{key:"errorFormat",value:function(e,t){var r,t={type:t?"retry":"error"};return e.xhr&&(r=e.xhr,e.req={url:r.currentUrl,param:r.params},e.res={status:r.status,header:r.getAllResponseHeaders(),body:r.responseText},e.extra&&(e.extra.req=e.req,e.extra.res=e.res),delete e.xhr),t4(e,t)}}],t5(e.prototype,t),r&&t5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}();function rt(e){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rr(){return(rr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function ri(e,t){for(var r=0;r<t.length;r++){var i,n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=function(e,t){if("object"!=rt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=rt(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(i=n.key,"string"),"symbol"==rt(i)?i:i+""),n)}}function rn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(rn=function(){return!!e})()}function ro(e){return(ro=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rs(e,t){return(rs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var ra=function(){var e,t,r;function i(e){var t,r,n,o;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),(r=this,n=i,o=[e],n=ro(n),t=function(e,t){if(t&&("object"===rt(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(r,rn()?Reflect.construct(n,o||[],ro(r).constructor):n.apply(r,o))).config=rr({},g),t._mergeOptions(t.config,e),t.tasks={},t.taskList={},t.cache={},t.storage=eS.storage(t,t.config.enableDiskBreakpoint),t.logger=t.config.noLog?{send:function(){}}:new ev(t.config,t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rs(e,t)}(i,p.a),e=i,t=[{key:"_mergeOptions",value:function(e,t){t&&"object"===rt(t)&&(rr(e,t),Object.keys(t).forEach(function(r){"vodDomain"===r&&(e.replace[r]=t[r])}))}},{key:"_setCache",value:function(e,t){this.storage.setItem(e,t)}},{key:"_getCache",value:function(e){return this.storage.getItem(e)}},{key:"_removeCache",value:function(e){e?this.storage.removeItem(e):this.storage.clear()}},{key:"_addTask",value:function(e,t){var r=this.tasks,i=this.taskList;r[e]&&r[e].task?i[e].push(t):(i[e]=[],i[e].push(t),r[e]=r[e]||{},r[e].task=new re([],this.config,this,e)),r[e].task.addTask(t)}},{key:"_broadcast",value:function(e,t,r){(r||1===(r=this.tasks[t.key].status)||0===r)&&this.emit(e,t)}},{key:"_addCrc32ProcessTask",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=r.isDirect,r=r.isImageBatchUpload,e=new eJ({file:e.file,context:this,key:t,isDirect:i,isImageBatchUpload:void 0!==r&&r},this.config),i={context:e,func:e.start,arg:{},key:t,index:0,stage:"crc32"};this._addTask(t,i)}},{key:"_addPreUploadTask",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=r.isDirect,r=r.isImageBatchUpload,i={file:e.file,stsToken:e.stsToken,context:this,type:e.type||el,preUploadUriParams:e.preUploadUriParams||{},storeKey:e.storeKey,testHost:e.testHost,key:t,isDirect:i,isImageBatchUpload:void 0!==r&&r,fileSize:e.fileSize,serviceType:e.serviceType||null},r=new e4(i,this.config),e={context:r,func:r.start,arg:{},key:t,index:1,stage:"preUpload"};this._addTask(t,e)}},{key:"_addDirectUploadTask",value:function(e,t){var r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).isImageBatchUpload,e=new tU({file:e.file,context:this,key:t,isImageBatchUpload:void 0!==r&&r},this.config),r={context:e,func:e.start,arg:{},key:t,index:3,stage:"process"};this._addTask(t,r)}},{key:"_addInitUploadIDTask",value:function(e,t){e={context:e=new ti({file:e.file,context:this,key:t},this.config),func:e.start,arg:{},key:t,index:2,stage:"initUploadID"},this._addTask(t,e)}},{key:"_addUploadProcessTask",value:function(e,t){e={context:e=new tS({file:e.file,context:this,key:t},this.config),func:e.start,arg:{},key:t,index:3,stage:"process"},this._addTask(t,e)}},{key:"_addStreamUploadTask",value:function(e,t){this.streamUploadTask=new tK({context:this,key:t},this.config);var r={context:this.streamUploadTask,func:this.streamUploadTask.start,arg:{},key:t,index:3,stage:"process"};this._addTask(t,r)}},{key:"_mergeFileTask",value:function(e,t){e={context:e=new tz({file:e.file,context:this,stage:"fileMerge",key:t},this.config),func:e.start,arg:{},key:t,index:4,stage:"fileMerge"},this._addTask(t,e)}},{key:"_getMetaInfoTask",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=r.isImageBatchUpload,r=r.skipCommit,i={file:e.file,context:this,data:e.data,type:e.type||el,callbackArgs:e.callbackArgs,objectSync:e.objectSync,needExactFormat:e.needExactFormat,key:t,isImageBatchUpload:void 0!==i&&i,skipCommit:void 0!==r&&r,serviceType:e.serviceType||null},r=new t1(i,this.config),e={context:r,func:r.start,arg:{},key:t,index:5,stage:"complete"};this._addTask(t,e)}},{key:"_addAllUploadProcess",value:function(e,t){var r=e.type===ef&&"[object Array]"===Object.prototype.toString.call(e.file),i=(this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||el,this.tasks[t].fileSize=e.file&&e.file.size,this.tasks[t].proxyStsToken=e.stsToken,this.lastStsToken=e.stsToken,this.lastFile=e.file,e.file.size<=eS.getFileSliceLength(e.file)||r),i=(e.useDirectUpload&&(i=!0),this._addCrc32ProcessTask(e,t,{isDirect:i,isImageBatchUpload:r}),this._addPreUploadTask(e,t,{isDirect:i,isImageBatchUpload:r}),i?this._addDirectUploadTask(e,t,{isImageBatchUpload:r}):(this._addInitUploadIDTask(e,t),this._addUploadProcessTask(e,t),this._mergeFileTask(e,t)),!(!this.config.skipCommit||eX.checkServiceName(e.type,this.config)!==ed));this._getMetaInfoTask(e,t,{isImageBatchUpload:r,skipCommit:i})}},{key:"_addAllUploadProcessClientEncrypt",value:function(e){var t,r=this;return e.type===ef&&Array.isArray(e.file)?(t=[],e.file.forEach(function(i){t.push(r._createClientEncryptTask({stsToken:e.stsToken,type:e.type,file:i}))}),t):this._createClientEncryptTask(e)}},{key:"_createClientEncryptTask",value:function(e){var t=eS.getUnique("file"),r=(this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||el,this.tasks[t].fileSize=e.file&&e.file.size,this.tasks[t].proxyStsToken=e.stsToken,this.tasks[t].clientEncryptKey=eS.generateKey(16),this._addCrc32ProcessTask(e,t,{isDirect:!1,isImageBatchUpload:!1}),this._addPreUploadTask(e,t,{isDirect:!1,isImageBatchUpload:!1}),this._addInitUploadIDTask(e,t),this._addUploadProcessTask(e,t),this._mergeFileTask(e,t),!(!this.config.skipCommit||eX.checkServiceName(e.type,this.config)!==ed));return this._getMetaInfoTask(e,t,{isImageBatchUpload:!1,skipCommit:r}),t}},{key:"_addAllStreamUploadProcess",value:function(e,t){this.tasks[t]=this.tasks[t]||{},this.tasks[t].fileType=e.type||el,this.tasks[t].proxyStsToken=e.stsToken,this._addPreUploadTask(e,t),this._addInitUploadIDTask(e,t),this._addStreamUploadTask(e,t),this._mergeFileTask(e,t),this._getMetaInfoTask(e,t)}},{key:"_addStreamSlice",value:function(e){var t=e.fileSlice,e=e.index;this.streamUploadTask.addStreamSlice({fileSlice:t,index:e})}},{key:"_completeStreamUpload",value:function(){this.streamUploadTask.completeStreamUpload()}},{key:"_run",value:function(e,t){var r=this.tasks,i=navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/);i&&i[1]&&9>=Number(i[1])?(this._broadcast("error",rr(r[e],{key:e,status:0,stage:"browserError",extra:{message:"cannot support the browser below ie10"},type:"error"})),this.logger.send(r[e]),this._cancel(e)):r[e]?3===r[e].status?this._restart(e):(r[e].startTime=(new Date).getTime(),r[e].task&&1!==r[e].status&&r[e].task.tasks.length&&(r[e].status=1,this.logger.send(rr({},r[e],{extra:{message:"start upload"},type:"start",key:e})),r[e].task.start(t))):console.warn("".concat(e," is not exit in object tasks, stop running..."))}},{key:"_selectRoute",value:function(e,t){new eM({stsToken:this.lastStsToken,context:this,type:el,file:this.lastFile},this.config).start(e,t)}},{key:"_restart",value:function(e){var t,r,i=this,n=this.tasks;n[e]?(t=n[e].task,r=n[e].currentTask||0,this.taskList[e].forEach(function(n,o){n.index===r&&(t.tasks=i.taskList[e].slice(o))}),t&&1!==n[e].status&&t.tasks.length&&(n[e].status=1,t.restart())):console.warn("".concat(e," is not exit in object tasks"))}},{key:"_cancel",value:function(e){var t=this.tasks;t[e]?(t[e].status=2,t[e].task.cancel(),delete this.taskList[e]):console.warn("".concat(e," is not exit in object tasks"))}},{key:"_pause",value:function(e){var t=this.tasks;t[e]?(t[e].status=3,t[e].task.cancel(!0),t[e].isDirect||this._saveTask(e)):console.warn("".concat(e," is not exit in object tasks"))}},{key:"_removeTaskCache",value:function(e){var t=this.tasks;t[e]?(t=t[e].crc32Key)&&this._removeCache(t):console.warn("".concat(e," is not exit in object tasks"))}},{key:"_saveTask",value:function(e,t){if(t=(e=rr({},this.tasks[e],t||{})).crc32Key)try{this._setCache(t,this.serializeCacheInfo(e))}catch(e){console.warn(e)}}},{key:"serializeCacheInfo",value:function(e){var t="";delete e.task,delete e.xhr,delete e.crc32Array;try{t=JSON.stringify(e)}catch(i){var r={};Object.keys(e).forEach(function(t){"task"!==t&&"xhr"!==t&&"crc32Array"!==t&&(r[t]=e[t])}),t=JSON.stringify(r)}return t}},{key:"_queueSuccess",value:function(e){var t,r=this.tasks;r[e]?(t=new Date,r[e].endTime=t.getTime(),r[e].time=r[e].endTime-r[e].startTime,r[e].status=0,delete this.taskList[e],delete r[e]):console.warn("".concat(e," is not exit in object tasks"))}},{key:"_removeFile",value:function(e){delete this.tasks[e]}},{key:"_batchAction",value:function(e,t){Object.keys(this.tasks).forEach(function(r){e&&e(r,t)})}},{key:"_refreshSTSToken",value:function(e){var t=this,r=this.tasks;Object.keys(r).forEach(function(i){var i=r[i],n=rr({},i,{proxyStsToken:e}),o=(i.proxyStsToken=e,n.crc32Key);o&&(i.proxyStsToken=e,t._setCache(o,t.serializeCacheInfo(n)))})}},{key:"_setOption",value:function(e){this._mergeOptions(this.config,e),e.userId&&!this.config.noLog&&this.logger.setUserUniqueId(e.userId),e.appId&&!this.config.noLog&&this.logger.setLineAppId(e.appId)}},{key:"_getOption",value:function(e){var t=rr({},this.config);return Object.keys(t).forEach(function(e){(-1<e.indexOf("Url")||"replace"===e||"log"===e)&&delete t[e]}),e?t[e]:t}},{key:"_userCancel",value:function(e){var t=this,r=this.tasks;e?(this._cancel(e),this.logger.send(rr({},r[e],{type:"cancel"})),delete this.tasks[e]):Object.keys(r).forEach(function(e){t._cancel(e),t.logger.send(rr({},r[e],{type:"cancel"})),delete t.tasks[e]})}},{key:"_userPause",value:function(e){var t=this,r=this.tasks;e?(this._pause(e),this.logger.send(rr({},r[e],{type:"pause"}))):Object.keys(r).forEach(function(e){t._pause(e),t.logger.send(rr({},r[e],{type:"pause"}))})}}],ri(e.prototype,t),r&&ri(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}();function rc(e){return(rc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ru(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function rl(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ru(Object(r),!0).forEach(function(t){var i,n,o;i=e,n=t,o=r[t],(n=rp(n))in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ru(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function rf(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,rp(i.key),i)}}function rp(e){return e=function(e,t){if("object"!=rc(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!=rc(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==rc(e)?e:e+""}function rh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(rh=function(){return!!e})()}function rd(e){return(rd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rg(e,t){return(rg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var ry=function(){var e,t,r;function i(){var e,t,r;return function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),e=this,t=i,r=arguments,t=rd(t),function(e,t){if(t&&("object"===rc(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0!==e)return e;throw ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(e,rh()?Reflect.construct(t,r||[],rd(e).constructor):t.apply(e,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rg(e,t)}(i,ra),e=i,t=[{key:"start",value:function(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.abort=!1,r.selectRoute?this._selectRoute(r,function(r){r=rl(rl({},r),{},{enableSelectRoute:!0}),e?t._run(e,r):t._batchAction(t._run.bind(t),r)}):e?this._run(e):this._batchAction(this._run.bind(this))}},{key:"addFile",value:function(e){var t;return e&&eX.checkStsToken(e.stsToken)?e.file&&this.config.clientEncrypt?this._addAllUploadProcessClientEncrypt(e):e.file?(t=eS.getUnique("file"),this._addAllUploadProcess(e,t),t):null:(this.emit("error",{extra:{message:eL,errorCode:1000002}}),null)}},{key:"addImageFile",value:function(e){var t;return e&&eX.checkStsToken(e.stsToken)?e.file?(e.type=e.type||ef,t=eS.getUnique("file"),this._addAllUploadProcess(e,t),t):null:(this.emit("error",{extra:{message:eL,errorCode:1000002}}),null)}},{key:"addStreamUploadTask",value:function(e){var t;return e&&eX.checkStsToken(e.stsToken)?(t=eS.getUnique("file"),this._addAllStreamUploadProcess(e,t),t):(this.emit("error",{extra:{message:eL,errorCode:1000002}}),null)}},{key:"addStreamSlice",value:function(e){var t=e.fileSlice,e=e.index;this._addStreamSlice({fileSlice:t,index:e})}},{key:"completeStreamUpload",value:function(){this._completeStreamUpload()}},{key:"removeFile",value:function(e){e&&this._removeFile(e)}},{key:"cancel",value:function(e){e?this._userCancel(e):this._batchAction(this._userCancel.bind(this))}},{key:"pause",value:function(e){this._userPause(e)}},{key:"restart",value:function(e){e?this._restart(e):this._batchAction(this._restart.bind(this))}},{key:"refreshSTSToken",value:function(e){this._refreshSTSToken(e)}},{key:"setOption",value:function(e){this._setOption(e)}},{key:"getOption",value:function(e){return this._getOption(e)}}],rf(e.prototype,t),r&&rf(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}()}]).default},"object"==typeof t&&"object"==typeof e?e.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof t?t.BytedUploader=n():i.BytedUploader=n()}}]);